---
title: "Boroski_etal_2024a"
author: "Chainey Boroski"
date: "Updated: 1.16.24"
output: ''
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

Complete.Js_QC <- read.csv("Complete.Js_1128.csv")

library(pacman)
p_load(tidyverse, ggplot2, dplyr, matrixStats, ggpubr, rstatix, broom, GGally, car, FSA, emmeans, gridExtra, cowplot, ggthemes, ggmap, maps, mapdata, multcompView)

virg_teal <- '#1B9E77'
short_orange <- '#D95F02'
lob2_purple <- '#7570B3'
lob1_pink <- '#E7298A'
slash_green <- '#66A61E'
long_gold <- '#E6AB02'
```

###Initial Dataframe Establishment

We start by creating a dataframe for each species which has data for all trees and the average values of Js for each. We identify the 90th percentile and select all data within this range. For each, we generate a dataframe for 90th percentile data, data where where REW > 0.2 and Dz > 0.5, and where data meet both of these conditions.
```{r virginia - data selection}
#Establish the terms for the for-loop.
spec <- "Virginia"
day <- c(117:365, 1:365, 1:366, 1:365, 1:365)
year <- c(rep(2018, 249), rep(2019, 365), rep(2020, 366), rep(2021, 365), rep(2022, 365))

year.list <- list()
day.list <- list()
mean.list <- list()
dz.list <- list()
rew.list <- list()
tree1.list <- list()
tree2.list <- list()
tree3.list <- list()
tree4.list <- list()
tree5.list <- list()
tree6.list <- list()
tree7.list <- list()

#Generate a mean overall Js, Dz, and REW, and a mean daily value of sap flux for each tree.
for(i in 1:1710){
  x <- mean(Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x2 <- mean(Complete.Js_QC$VPDz[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x3 <- mean(Complete.Js_QC$REWAvg[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  tree1 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 1]
  tree2 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 2]
  tree3 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 3]
  tree4 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 4]
  tree5 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 5]
  tree6 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 6]
  tree7 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 7]
  year.list <- c(year.list, year[i])
  day.list <- c(day.list, day[i])
  mean.list <- c(mean.list, x)
  dz.list <- c(dz.list, x2)
  rew.list <- c(rew.list, x3)
  tree1.list <- c(tree1.list, tree1)
  tree2.list <- c(tree2.list, tree2)
  tree3.list <- c(tree3.list, tree3)
  tree4.list <- c(tree4.list, tree4)
  tree5.list <- c(tree5.list, tree5)
  tree6.list <- c(tree6.list, tree6)
  tree7.list <- c(tree7.list, tree7)
}

yearlist <- unlist(year.list)
daylist <- unlist(day.list)
meanlist <- unlist(mean.list)
dzlist <- unlist(dz.list)
rewlist <- unlist(rew.list)
tree1.list <- unlist(tree1.list)
tree2.list <- unlist(tree2.list)
tree3.list <- unlist(tree3.list)
tree4.list <- unlist(tree4.list)
tree5.list <- unlist(tree5.list)
tree6.list <- unlist(tree6.list)
tree7.list <- unlist(tree7.list)

#Combine this data into a dataframe, and save for virginia.
testdata <- data.frame(Year = yearlist, Day = daylist, Dz = dzlist, REW = rewlist,
                       Species = spec, Average = meanlist, Tree1 = tree1.list, Tree2 = tree2.list,
                       Tree3 = tree3.list, Tree4 = tree4.list, Tree5 = tree5.list, Tree6 = tree6.list,
                       Tree7 = tree7.list)
testdata_virg <- testdata

#Separate by year. For each year, select all data above the 90th percentile.
testdata18 <- subset(testdata, testdata$Year == 2018)
testdata19 <- subset(testdata, testdata$Year == 2019)
testdata20 <- subset(testdata, testdata$Year == 2020)
testdata21 <- subset(testdata, testdata$Year == 2021)
testdata22 <- subset(testdata, testdata$Year == 2022)

td <- testdata18

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut18 <- td_avgcut
td_dzrewcut18 <- td_dzrewcut
td_fullcut18 <- td_fullcut

td <- testdata19

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut19 <- td_avgcut
td_dzrewcut19 <- td_dzrewcut
td_fullcut19 <- td_fullcut

td <- testdata20

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut20 <- td_avgcut
td_dzrewcut20 <- td_dzrewcut
td_fullcut20 <- td_fullcut

td <- testdata21

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut21 <- td_avgcut
td_dzrewcut21 <- td_dzrewcut
td_fullcut21 <- td_fullcut

td <- testdata22

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut22 <- td_avgcut
td_dzrewcut22 <- td_dzrewcut
td_fullcut22 <- td_fullcut

td_avgcut_virg <- rbind(td_avgcut18, td_avgcut19, td_avgcut20, td_avgcut21, td_avgcut22)
td_dzrewcut_virg <- rbind(td_dzrewcut18, td_dzrewcut19, td_dzrewcut20, td_dzrewcut21, td_dzrewcut22)
td_fullcut_virg <- rbind(td_fullcut18, td_fullcut19, td_fullcut20, td_fullcut21, td_fullcut22)
#We'll use the "full cut" data for our analyses, which restricts Dz and REW to "optimal" levels.
```

```{r shortleaf - data selection}
spec <- "Shortleaf"
day <- c(117:365, 1:365, 1:366, 1:365, 1:365)
year <- c(rep(2018, 249), rep(2019, 365), rep(2020, 366), rep(2021, 365), rep(2022, 365))

year.list <- list()
day.list <- list()
mean.list <- list()
dz.list <- list()
rew.list <- list()
tree1.list <- list()
tree2.list <- list()
tree3.list <- list()
tree4.list <- list()
tree5.list <- list()
tree6.list <- list()
tree7.list <- list()

for(i in 1:1710){
  x <- mean(Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x2 <- mean(Complete.Js_QC$VPDz[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x3 <- mean(Complete.Js_QC$REWAvg[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  tree1 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 1]
  tree2 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 2]
  tree3 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 3]
  tree4 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 4]
  tree5 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 5]
  tree6 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 6]
  tree7 <- NA
  year.list <- c(year.list, year[i])
  day.list <- c(day.list, day[i])
  mean.list <- c(mean.list, x)
  dz.list <- c(dz.list, x2)
  rew.list <- c(rew.list, x3)
  tree1.list <- c(tree1.list, tree1)
  tree2.list <- c(tree2.list, tree2)
  tree3.list <- c(tree3.list, tree3)
  tree4.list <- c(tree4.list, tree4)
  tree5.list <- c(tree5.list, tree5)
  tree6.list <- c(tree6.list, tree6)
  tree7.list <- c(tree7.list, tree7)
}

yearlist <- unlist(year.list)
daylist <- unlist(day.list)
meanlist <- unlist(mean.list)
dzlist <- unlist(dz.list)
rewlist <- unlist(rew.list)
tree1.list <- unlist(tree1.list)
tree2.list <- unlist(tree2.list)
tree3.list <- unlist(tree3.list)
tree4.list <- unlist(tree4.list)
tree5.list <- unlist(tree5.list)
tree6.list <- unlist(tree6.list)
tree7.list <- unlist(tree7.list)

testdata <- data.frame(Year = yearlist, Day = daylist, Dz = dzlist, REW = rewlist,
                       Species = spec, Average = meanlist, Tree1 = tree1.list, Tree2 = tree2.list,
                       Tree3 = tree3.list, Tree4 = tree4.list, Tree5 = tree5.list, Tree6 = tree6.list,
                       Tree7 = tree7.list)
testdata_short <- testdata

testdata18 <- subset(testdata, testdata$Year == 2018)
testdata19 <- subset(testdata, testdata$Year == 2019)
testdata20 <- subset(testdata, testdata$Year == 2020)
testdata21 <- subset(testdata, testdata$Year == 2021)
testdata22 <- subset(testdata, testdata$Year == 2022)

td <- testdata18

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut18 <- td_avgcut
td_dzrewcut18 <- td_dzrewcut
td_fullcut18 <- td_fullcut

td <- testdata19

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut19 <- td_avgcut
td_dzrewcut19 <- td_dzrewcut
td_fullcut19 <- td_fullcut

td <- testdata20

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut20 <- td_avgcut
td_dzrewcut20 <- td_dzrewcut
td_fullcut20 <- td_fullcut

td <- testdata21

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut21 <- td_avgcut
td_dzrewcut21 <- td_dzrewcut
td_fullcut21 <- td_fullcut

td <- testdata22

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut22 <- td_avgcut
td_dzrewcut22 <- td_dzrewcut
td_fullcut22 <- td_fullcut

td_avgcut_short <- rbind(td_avgcut18, td_avgcut19, td_avgcut20, td_avgcut21, td_avgcut22)
td_dzrewcut_short <- rbind(td_dzrewcut18, td_dzrewcut19, td_dzrewcut20, td_dzrewcut21, td_dzrewcut22)
td_fullcut_short <- rbind(td_fullcut18, td_fullcut19, td_fullcut20, td_fullcut21, td_fullcut22)
```

```{r loblolly2 - data selection}
spec <- "Loblolly2"
day <- c(117:365, 1:365, 1:366, 1:365, 1:365)
year <- c(rep(2018, 249), rep(2019, 365), rep(2020, 366), rep(2021, 365), rep(2022, 365))

year.list <- list()
day.list <- list()
mean.list <- list()
dz.list <- list()
rew.list <- list()
tree1.list <- list()
tree2.list <- list()
tree3.list <- list()
tree4.list <- list()
tree5.list <- list()
tree6.list <- list()
tree7.list <- list()

for(i in 1:1710){
  x <- mean(Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x2 <- mean(Complete.Js_QC$VPDz[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x3 <- mean(Complete.Js_QC$REWAvg[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  tree1 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 1]
  tree2 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 2]
  tree3 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 3]
  tree4 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 4]
  tree5 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 5]
  tree6 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 6]
  tree7 <- NA
  year.list <- c(year.list, year[i])
  day.list <- c(day.list, day[i])
  mean.list <- c(mean.list, x)
  dz.list <- c(dz.list, x2)
  rew.list <- c(rew.list, x3)
  tree1.list <- c(tree1.list, tree1)
  tree2.list <- c(tree2.list, tree2)
  tree3.list <- c(tree3.list, tree3)
  tree4.list <- c(tree4.list, tree4)
  tree5.list <- c(tree5.list, tree5)
  tree6.list <- c(tree6.list, tree6)
  tree7.list <- c(tree7.list, tree7)
}

yearlist <- unlist(year.list)
daylist <- unlist(day.list)
meanlist <- unlist(mean.list)
dzlist <- unlist(dz.list)
rewlist <- unlist(rew.list)
tree1.list <- unlist(tree1.list)
tree2.list <- unlist(tree2.list)
tree3.list <- unlist(tree3.list)
tree4.list <- unlist(tree4.list)
tree5.list <- unlist(tree5.list)
tree6.list <- unlist(tree6.list)
tree7.list <- unlist(tree7.list)

testdata <- data.frame(Year = yearlist, Day = daylist, Dz = dzlist, REW = rewlist,
                       Species = spec, Average = meanlist, Tree1 = tree1.list, Tree2 = tree2.list,
                       Tree3 = tree3.list, Tree4 = tree4.list, Tree5 = tree5.list, Tree6 = tree6.list,
                       Tree7 = tree7.list)
testdata_lob2 <- testdata

testdata18 <- subset(testdata, testdata$Year == 2018)
testdata19 <- subset(testdata, testdata$Year == 2019)
testdata20 <- subset(testdata, testdata$Year == 2020)
testdata21 <- subset(testdata, testdata$Year == 2021)
testdata22 <- subset(testdata, testdata$Year == 2022)

td <- testdata18

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut18 <- td_avgcut
td_dzrewcut18 <- td_dzrewcut
td_fullcut18 <- td_fullcut

td <- testdata19

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut19 <- td_avgcut
td_dzrewcut19 <- td_dzrewcut
td_fullcut19 <- td_fullcut

td <- testdata20

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut20 <- td_avgcut
td_dzrewcut20 <- td_dzrewcut
td_fullcut20 <- td_fullcut

td <- testdata21

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut21 <- td_avgcut
td_dzrewcut21 <- td_dzrewcut
td_fullcut21 <- td_fullcut

td <- testdata22

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut22 <- td_avgcut
td_dzrewcut22 <- td_dzrewcut
td_fullcut22 <- td_fullcut

td_avgcut_lob2 <- rbind(td_avgcut18, td_avgcut19, td_avgcut20, td_avgcut21, td_avgcut22)
td_dzrewcut_lob2 <- rbind(td_dzrewcut18, td_dzrewcut19, td_dzrewcut20, td_dzrewcut21, td_dzrewcut22)
td_fullcut_lob2 <- rbind(td_fullcut18, td_fullcut19, td_fullcut20, td_fullcut21, td_fullcut22)
```

```{r loblolly1 - data selection}
spec <- "Loblolly1"
day <- c(117:365, 1:365, 1:366, 1:365, 1:365)
year <- c(rep(2018, 249), rep(2019, 365), rep(2020, 366), rep(2021, 365), rep(2022, 365))

year.list <- list()
day.list <- list()
mean.list <- list()
dz.list <- list()
rew.list <- list()
tree1.list <- list()
tree2.list <- list()
tree3.list <- list()
tree4.list <- list()
tree5.list <- list()
tree6.list <- list()
tree7.list <- list()

for(i in 1:1710){
  x <- mean(Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x2 <- mean(Complete.Js_QC$VPDz[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x3 <- mean(Complete.Js_QC$REWAvg[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  tree1 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 7]
  tree2 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 8]
  tree3 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 9]
  tree4 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 10]
  tree5 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 11]
  tree6 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 12]
  tree7 <- NA
  year.list <- c(year.list, year[i])
  day.list <- c(day.list, day[i])
  mean.list <- c(mean.list, x)
  dz.list <- c(dz.list, x2)
  rew.list <- c(rew.list, x3)
  tree1.list <- c(tree1.list, tree1)
  tree2.list <- c(tree2.list, tree2)
  tree3.list <- c(tree3.list, tree3)
  tree4.list <- c(tree4.list, tree4)
  tree5.list <- c(tree5.list, tree5)
  tree6.list <- c(tree6.list, tree6)
  tree7.list <- c(tree7.list, tree7)
}

yearlist <- unlist(year.list)
daylist <- unlist(day.list)
meanlist <- unlist(mean.list)
dzlist <- unlist(dz.list)
rewlist <- unlist(rew.list)
tree1.list <- unlist(tree1.list)
tree2.list <- unlist(tree2.list)
tree3.list <- unlist(tree3.list)
tree4.list <- unlist(tree4.list)
tree5.list <- unlist(tree5.list)
tree6.list <- unlist(tree6.list)
tree7.list <- unlist(tree7.list)

testdata <- data.frame(Year = yearlist, Day = daylist, Dz = dzlist, REW = rewlist,
                       Species = spec, Average = meanlist, Tree1 = tree1.list, Tree2 = tree2.list,
                       Tree3 = tree3.list, Tree4 = tree4.list, Tree5 = tree5.list, Tree6 = tree6.list,
                       Tree7 = tree7.list)
testdata_lob1 <- testdata

testdata18 <- subset(testdata, testdata$Year == 2018)
testdata19 <- subset(testdata, testdata$Year == 2019)
testdata20 <- subset(testdata, testdata$Year == 2020)
testdata21 <- subset(testdata, testdata$Year == 2021)
testdata22 <- subset(testdata, testdata$Year == 2022)

td <- testdata18

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut18 <- td_avgcut
td_dzrewcut18 <- td_dzrewcut
td_fullcut18 <- td_fullcut

td <- testdata19

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut19 <- td_avgcut
td_dzrewcut19 <- td_dzrewcut
td_fullcut19 <- td_fullcut

td <- testdata20

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut20 <- td_avgcut
td_dzrewcut20 <- td_dzrewcut
td_fullcut20 <- td_fullcut

td <- testdata21

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut21 <- td_avgcut
td_dzrewcut21 <- td_dzrewcut
td_fullcut21 <- td_fullcut

td <- testdata22

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut22 <- td_avgcut
td_dzrewcut22 <- td_dzrewcut
td_fullcut22 <- td_fullcut

td_avgcut_lob1 <- rbind(td_avgcut18, td_avgcut19, td_avgcut20, td_avgcut21, td_avgcut22)
td_dzrewcut_lob1 <- rbind(td_dzrewcut18, td_dzrewcut19, td_dzrewcut20, td_dzrewcut21, td_dzrewcut22)
td_fullcut_lob1 <- rbind(td_fullcut18, td_fullcut19, td_fullcut20, td_fullcut21, td_fullcut22)
```

```{r slash - data selection}
spec <- "Slash"
day <- c(117:365, 1:365, 1:366, 1:365, 1:365)
year <- c(rep(2018, 249), rep(2019, 365), rep(2020, 366), rep(2021, 365), rep(2022, 365))

year.list <- list()
day.list <- list()
mean.list <- list()
dz.list <- list()
rew.list <- list()
tree1.list <- list()
tree2.list <- list()
tree3.list <- list()
tree4.list <- list()
tree5.list <- list()
tree6.list <- list()
tree7.list <- list()

for(i in 1:1710){
  x <- mean(Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x2 <- mean(Complete.Js_QC$VPDz[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x3 <- mean(Complete.Js_QC$REWAvg[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  tree1 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 1]
  tree2 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 2]
  tree3 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 3]
  tree4 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 4]
  tree5 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 5]
  tree6 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 6]
  tree7 <- NA
  year.list <- c(year.list, year[i])
  day.list <- c(day.list, day[i])
  mean.list <- c(mean.list, x)
  dz.list <- c(dz.list, x2)
  rew.list <- c(rew.list, x3)
  tree1.list <- c(tree1.list, tree1)
  tree2.list <- c(tree2.list, tree2)
  tree3.list <- c(tree3.list, tree3)
  tree4.list <- c(tree4.list, tree4)
  tree5.list <- c(tree5.list, tree5)
  tree6.list <- c(tree6.list, tree6)
  tree7.list <- c(tree7.list, tree7)
}

yearlist <- unlist(year.list)
daylist <- unlist(day.list)
meanlist <- unlist(mean.list)
dzlist <- unlist(dz.list)
rewlist <- unlist(rew.list)
tree1.list <- unlist(tree1.list)
tree2.list <- unlist(tree2.list)
tree3.list <- unlist(tree3.list)
tree4.list <- unlist(tree4.list)
tree5.list <- unlist(tree5.list)
tree6.list <- unlist(tree6.list)
tree7.list <- unlist(tree7.list)

testdata <- data.frame(Year = yearlist, Day = daylist, Dz = dzlist, REW = rewlist,
                       Species = spec, Average = meanlist, Tree1 = tree1.list, Tree2 = tree2.list,
                       Tree3 = tree3.list, Tree4 = tree4.list, Tree5 = tree5.list, Tree6 = tree6.list,
                       Tree7 = tree7.list)
testdata_slash <- testdata

testdata18 <- subset(testdata, testdata$Year == 2018)
testdata19 <- subset(testdata, testdata$Year == 2019)
testdata20 <- subset(testdata, testdata$Year == 2020)
testdata21 <- subset(testdata, testdata$Year == 2021)
testdata22 <- subset(testdata, testdata$Year == 2022)

td <- testdata18

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut18 <- td_avgcut
td_dzrewcut18 <- td_dzrewcut
td_fullcut18 <- td_fullcut

td <- testdata19

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut19 <- td_avgcut
td_dzrewcut19 <- td_dzrewcut
td_fullcut19 <- td_fullcut

td <- testdata20

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut20 <- td_avgcut
td_dzrewcut20 <- td_dzrewcut
td_fullcut20 <- td_fullcut

td <- testdata21

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut21 <- td_avgcut
td_dzrewcut21 <- td_dzrewcut
td_fullcut21 <- td_fullcut

td <- testdata22

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut22 <- td_avgcut
td_dzrewcut22 <- td_dzrewcut
td_fullcut22 <- td_fullcut

td_avgcut_slash <- rbind(td_avgcut18, td_avgcut19, td_avgcut20, td_avgcut21, td_avgcut22)
td_dzrewcut_slash <- rbind(td_dzrewcut18, td_dzrewcut19, td_dzrewcut20, td_dzrewcut21, td_dzrewcut22)
td_fullcut_slash <- rbind(td_fullcut18, td_fullcut19, td_fullcut20, td_fullcut21, td_fullcut22)
```

```{r longleaf - data selection}
spec <- "Longleaf"
day <- c(117:365, 1:365, 1:366, 1:365)
year <- c(rep(2018, 249), rep(2019, 365), rep(2020, 366), rep(2021, 365))

year.list <- list()
day.list <- list()
mean.list <- list()
dz.list <- list()
rew.list <- list()
tree1.list <- list()
tree2.list <- list()
tree3.list <- list()
tree4.list <- list()
tree5.list <- list()
tree6.list <- list()
tree7.list <- list()

for(i in 1:1345){
  x <- mean(Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x2 <- mean(Complete.Js_QC$VPDz[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  x3 <- mean(Complete.Js_QC$REWAvg[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec], na.rm = T)
  tree1 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 1]
  tree2 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 2]
  tree3 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 3]
  tree4 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 4]
  tree5 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 5]
  tree6 <- Complete.Js_QC$Out.Js[Complete.Js_QC$Year == year[i] & Complete.Js_QC$Day == day[i] & Complete.Js_QC$Species == spec & Complete.Js_QC$Tree == 6]
  tree7 <- NA
  year.list <- c(year.list, year[i])
  day.list <- c(day.list, day[i])
  mean.list <- c(mean.list, x)
  dz.list <- c(dz.list, x2)
  rew.list <- c(rew.list, x3)
  tree1.list <- c(tree1.list, tree1)
  tree2.list <- c(tree2.list, tree2)
  tree3.list <- c(tree3.list, tree3)
  tree4.list <- c(tree4.list, tree4)
  tree5.list <- c(tree5.list, tree5)
  tree6.list <- c(tree6.list, tree6)
  tree7.list <- c(tree7.list, tree7)
}

yearlist <- unlist(year.list)
daylist <- unlist(day.list)
meanlist <- unlist(mean.list)
dzlist <- unlist(dz.list)
rewlist <- unlist(rew.list)
tree1.list <- unlist(tree1.list)
tree2.list <- unlist(tree2.list)
tree3.list <- unlist(tree3.list)
tree4.list <- unlist(tree4.list)
tree5.list <- unlist(tree5.list)
tree6.list <- unlist(tree6.list)
tree7.list <- unlist(tree7.list)

testdata <- data.frame(Year = yearlist, Day = daylist, Dz = dzlist, REW = rewlist,
                       Species = spec, Average = meanlist, Tree1 = tree1.list, Tree2 = tree2.list,
                       Tree3 = tree3.list, Tree4 = tree4.list, Tree5 = tree5.list, Tree6 = tree6.list,
                       Tree7 = tree7.list)
testdata_long <- testdata

testdata18 <- subset(testdata, testdata$Year == 2018)
testdata19 <- subset(testdata, testdata$Year == 2019)
testdata20 <- subset(testdata, testdata$Year == 2020)
testdata21 <- subset(testdata, testdata$Year == 2021)
testdata22 <- subset(testdata, testdata$Year == 2022)

td <- testdata18

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut18 <- td_avgcut
td_dzrewcut18 <- td_dzrewcut
td_fullcut18 <- td_fullcut

td <- testdata19

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut19 <- td_avgcut
td_dzrewcut19 <- td_dzrewcut
td_fullcut19 <- td_fullcut

td <- testdata20

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut20 <- td_avgcut
td_dzrewcut20 <- td_dzrewcut
td_fullcut20 <- td_fullcut

td <- testdata21

lim <- quantile(td$Average, 0.90, na.rm = T)

td_avgcut <- subset(td, td$Average > lim)
td_dzrewcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2)
td_fullcut <- subset(td, td$Dz > 0.5 & td$REW > 0.2 & td$Average > lim)

length(td_avgcut$Day)
length(td_dzrewcut$Day)
length(td_fullcut$Day)

td_avgcut21 <- td_avgcut
td_dzrewcut21 <- td_dzrewcut
td_fullcut21 <- td_fullcut

td_avgcut_long <- rbind(td_avgcut18, td_avgcut19, td_avgcut20, td_avgcut21, td_avgcut22)
td_dzrewcut_long <- rbind(td_dzrewcut18, td_dzrewcut19, td_dzrewcut20, td_dzrewcut21, td_dzrewcut22)
td_fullcut_long <- rbind(td_fullcut18, td_fullcut19, td_fullcut20, td_fullcut21, td_fullcut22)
```

###Establish Optimal Conditions Dataframes
Here, we combine the species-specific dataframes into the three categories, and finally constrain the most limited dataframe to the two-month observation window. 
```{r combine into dataframes}
td_avgcut_all <- rbind(td_avgcut_virg, td_avgcut_short, td_avgcut_lob2, td_avgcut_lob1, td_avgcut_slash, td_avgcut_long)

td_dzrewcut_all <- rbind(td_dzrewcut_virg, td_dzrewcut_short, td_dzrewcut_lob2, td_dzrewcut_lob1, td_dzrewcut_slash, td_dzrewcut_long)

td_fullcut_all <- rbind(td_fullcut_virg, td_fullcut_short, td_fullcut_lob2, td_fullcut_lob1, td_fullcut_slash, td_fullcut_long)

td_final <- subset(td_fullcut_all, td_fullcut_all$Day > 151 & td_fullcut_all$Day < 213 & td_fullcut_all$Dz > 0.8 & td_fullcut_all$Dz < 1)
View(td_final)
```

We then use the data from td_final, the most constrained dataframe, to identify days where the selected values of Js occur. We then select the average Js and El data from these days, as well as corresponding values of environmental and physical data.
```{r dz and rew - optimal df}
yr <- 2018
df <- td_final[td_final$Year == yr,]
dt_env18 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(Dz, na.rm = T), r=mean(REW, na.rm = T))

yr <- 2019
df <- td_final[td_final$Year == yr,]
dt_env19 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(Dz, na.rm = T), r=mean(REW, na.rm = T))

yr <- 2020
df <- td_final[td_final$Year == yr,]
dt_env20 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(Dz, na.rm = T), r=mean(REW, na.rm = T))

yr <- 2021
df <- td_final[td_final$Year == yr,]
dt_env21 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(Dz, na.rm = T), r=mean(REW, na.rm = T))


yr <- 2022
df <- td_final[td_final$Year == yr,]
dt_env22 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(Dz, na.rm = T), r=mean(REW, na.rm = T))

dt_env <- rbind(dt_env18, dt_env19, dt_env20, dt_env21, dt_env22)

boxplot(dt_env$d~dt_env$y)
```

```{r virginia - optimal df}
spec <- "Virginia"
yr <- 2018
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_virg18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_virg19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_virg20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_virg21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_virg22 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dt_virg <- rbind(dt_virg18, dt_virg19, dt_virg20, dt_virg21, dt_virg22)

dt1 <- group_by(dt_virg18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_18 <- mean(dt1$asal)

dt1 <- group_by(dt_virg19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_19 <- mean(dt1$asal)

dt1 <- group_by(dt_virg20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_20 <- mean(dt1$asal)

dt1 <- group_by(dt_virg21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_21 <- mean(dt1$asal) 

dt1 <- group_by(dt_virg22, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_22 <- mean(dt1$asal) 

dt_virg$gradient_wet <- 1.73
dt_virg$gradient_dry <- 1.25
dt_virg$kplant_wet <- 0.709
dt_virg$kplant_dry <- 0.280

dt_virg$as_mean <- NA

dt_virg$as_mean[dt_virg$y == 2018] <- virg_asal_18*10000
dt_virg$as_mean[dt_virg$y == 2019] <- virg_asal_19*10000
dt_virg$as_mean[dt_virg$y == 2020] <- virg_asal_20*10000
dt_virg$as_mean[dt_virg$y == 2021] <- virg_asal_21*10000
dt_virg$as_mean[dt_virg$y == 2022] <- virg_asal_22*10000

dt_virg$gradient_wet_adj <- dt_virg$gradient_wet-(0.01*dt_virg$h)
dt_virg$gradient_dry_adj <- dt_virg$gradient_dry-(0.01*dt_virg$h)
dt_virg$lump_wet <- dt_virg$gradient_wet_adj*(1/dt_virg$h)*dt_virg$as_mean/10000
dt_virg$lump_dry <- dt_virg$gradient_dry_adj*(1/dt_virg$h)*dt_virg$as_mean/10000
dt_virg$kplant_h <- dt_virg$kplant_wet*(1/dt_virg$h)
dt_virg$path_effs <- dt_virg$gradient_wet_adj*(1/dt_virg$h)

boxplot(dt_virg$j~dt_virg$y)
```

```{r shortleaf - optimal df}
spec <- "Shortleaf"
yr <- 2018
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_short18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_short19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_short20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_short21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_short22 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dt_short <- rbind(dt_short18, dt_short19, dt_short20, dt_short21, dt_short22)

dt1 <- group_by(dt_short18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_18 <- mean(dt1$asal)

dt1 <- group_by(dt_short19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_19 <- mean(dt1$asal)

dt1 <- group_by(dt_short20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_20 <- mean(dt1$asal)

dt1 <- group_by(dt_short21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_21 <- mean(dt1$asal) 

dt1 <- group_by(dt_short22, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_22 <- mean(dt1$asal) 

dt_short$gradient_wet <- 1.98
dt_short$gradient_dry <- 1.40
dt_short$kplant_wet <- 0.593
dt_short$kplant_dry <- 0.267

dt_short$as_mean <- NA

dt_short$as_mean[dt_short$y == 2018] <- short_asal_18*10000
dt_short$as_mean[dt_short$y == 2019] <- short_asal_19*10000
dt_short$as_mean[dt_short$y == 2020] <- short_asal_20*10000
dt_short$as_mean[dt_short$y == 2021] <- short_asal_21*10000
dt_short$as_mean[dt_short$y == 2022] <- short_asal_22*10000

dt_short$gradient_wet_adj <- dt_short$gradient_wet-(0.01*dt_short$h)
dt_short$gradient_dry_adj <- dt_short$gradient_dry-(0.01*dt_short$h)
dt_short$lump_wet <- dt_short$gradient_wet_adj*(1/dt_short$h)*dt_short$as_mean/10000
dt_short$lump_dry <- dt_short$gradient_dry_adj*(1/dt_short$h)*dt_short$as_mean/10000
dt_short$kplant_h <- dt_short$kplant_wet*(1/dt_short$h)
dt_short$path_effs <- dt_short$gradient_wet_adj*(1/dt_short$h)
```

```{r loblolly2 - optimal df}
spec <- "Loblolly2"
yr <- 2018
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob218 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob219 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob220 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob221 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob222 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dt_lob2 <- rbind(dt_lob218, dt_lob219, dt_lob220, dt_lob221, dt_lob222)

dt1 <- group_by(dt_lob218, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_18 <- mean(dt1$asal)

dt1 <- group_by(dt_lob219, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_19 <- mean(dt1$asal)

dt1 <- group_by(dt_lob220, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_20 <- mean(dt1$asal)

dt1 <- group_by(dt_lob221, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_21 <- mean(dt1$asal) 

dt1 <- group_by(dt_lob222, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_22 <- mean(dt1$asal) 

dt_lob2$gradient_wet <- 1.75
dt_lob2$gradient_dry <- 1.15
dt_lob2$kplant_wet <- 0.776
dt_lob2$kplant_dry <- 0.345

dt_lob2$as_mean <- NA

dt_lob2$as_mean[dt_lob2$y == 2018] <- lob2_asal_18*10000
dt_lob2$as_mean[dt_lob2$y == 2019] <- lob2_asal_19*10000
dt_lob2$as_mean[dt_lob2$y == 2020] <- lob2_asal_20*10000
dt_lob2$as_mean[dt_lob2$y == 2021] <- lob2_asal_21*10000
dt_lob2$as_mean[dt_lob2$y == 2022] <- lob2_asal_22*10000

dt_lob2$gradient_wet_adj <- dt_lob2$gradient_wet-(0.01*dt_lob2$h)
dt_lob2$gradient_dry_adj <- dt_lob2$gradient_dry-(0.01*dt_lob2$h)
dt_lob2$lump_wet <- dt_lob2$gradient_wet_adj*(1/dt_lob2$h)*dt_lob2$as_mean/10000
dt_lob2$lump_dry <- dt_lob2$gradient_dry_adj*(1/dt_lob2$h)*dt_lob2$as_mean/10000
dt_lob2$kplant_h <- dt_lob2$kplant_wet*(1/dt_lob2$h)
dt_lob2$path_effs <- dt_lob2$gradient_wet_adj*(1/dt_lob2$h)
```

```{r loblolly1 - optimal df}
spec <- "Loblolly1"
yr <- 2018
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob118 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob119 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob120 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob121 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_lob122 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dt_lob1 <- rbind(dt_lob118, dt_lob119, dt_lob120, dt_lob121, dt_lob122)

dt1 <- group_by(dt_lob118, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_18 <- mean(dt1$asal)

dt1 <- group_by(dt_lob119, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_19 <- mean(dt1$asal)

dt1 <- group_by(dt_lob120, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_20 <- mean(dt1$asal)

dt1 <- group_by(dt_lob121, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_21 <- mean(dt1$asal) 

dt1 <- group_by(dt_lob122, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_22 <- mean(dt1$asal) 

dt_lob1$gradient_wet <- 1.57
dt_lob1$gradient_dry <- 1.06
dt_lob1$kplant_wet <- 0.825
dt_lob1$kplant_dry <- 0.390

dt_lob1$as_mean <- NA

dt_lob1$as_mean[dt_lob1$y == 2018] <- lob1_asal_18*10000
dt_lob1$as_mean[dt_lob1$y == 2019] <- lob1_asal_19*10000
dt_lob1$as_mean[dt_lob1$y == 2020] <- lob1_asal_20*10000
dt_lob1$as_mean[dt_lob1$y == 2021] <- lob1_asal_21*10000
dt_lob1$as_mean[dt_lob1$y == 2022] <- lob1_asal_22*10000

dt_lob1$gradient_wet_adj <- dt_lob1$gradient_wet-(0.01*dt_lob1$h)
dt_lob1$gradient_dry_adj <- dt_lob1$gradient_dry-(0.01*dt_lob1$h)
dt_lob1$lump_wet <- dt_lob1$gradient_wet_adj*(1/dt_lob1$h)*dt_lob1$as_mean/10000
dt_lob1$lump_dry <- dt_lob1$gradient_dry_adj*(1/dt_lob1$h)*dt_lob1$as_mean/10000
dt_lob1$kplant_h <- dt_lob1$kplant_wet*(1/dt_lob1$h)
dt_lob1$path_effs <- dt_lob1$gradient_wet_adj*(1/dt_lob1$h)
```

```{r slash - optimal df}
spec <- "Slash"
yr <- 2018
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_slash18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_slash19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_slash20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_slash21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_slash22 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dt_slash <- rbind(dt_slash18, dt_slash19, dt_slash20, dt_slash21, dt_slash22)

dt1 <- group_by(dt_slash18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_18 <- mean(dt1$asal)

dt1 <- group_by(dt_slash19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_19 <- mean(dt1$asal)

dt1 <- group_by(dt_slash20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_20 <- mean(dt1$asal)

dt1 <- group_by(dt_slash21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_21 <- mean(dt1$asal) 

dt1 <- group_by(dt_slash22, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_22 <- mean(dt1$asal) 

dt_slash$gradient_wet <- 1.52
dt_slash$gradient_dry <- 1.11
dt_slash$kplant_wet <- 0.923
dt_slash$kplant_dry <- 0.339

dt_slash$as_mean <- NA

dt_slash$as_mean[dt_slash$y == 2018] <- slash_asal_18*10000
dt_slash$as_mean[dt_slash$y == 2019] <- slash_asal_19*10000
dt_slash$as_mean[dt_slash$y == 2020] <- slash_asal_20*10000
dt_slash$as_mean[dt_slash$y == 2021] <- slash_asal_21*10000
dt_slash$as_mean[dt_slash$y == 2022] <- slash_asal_22*10000

dt_slash$gradient_wet_adj <- dt_slash$gradient_wet-(0.01*dt_slash$h)
dt_slash$gradient_dry_adj <- dt_slash$gradient_dry-(0.01*dt_slash$h)
dt_slash$lump_wet <- dt_slash$gradient_wet_adj*(1/dt_slash$h)*dt_slash$as_mean/10000
dt_slash$lump_dry <- dt_slash$gradient_dry_adj*(1/dt_slash$h)*dt_slash$as_mean/10000
dt_slash$kplant_h <- dt_slash$kplant_wet*(1/dt_slash$h)
dt_slash$path_effs <- dt_slash$gradient_wet_adj*(1/dt_slash$h)
```

```{r longleaf - optimal df}
spec <- "Longleaf"
yr <- 2018
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_long18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_long19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_long20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final$Day[td_final$Year == yr & td_final$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dt_long21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dt_long <- rbind(dt_long18, dt_long19, dt_long20, dt_long21)

dt1 <- group_by(dt_long18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_18 <- mean(dt1$asal)

dt1 <- group_by(dt_long19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_19 <- mean(dt1$asal)

dt1 <- group_by(dt_long20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_20 <- mean(dt1$asal)

dt1 <- group_by(dt_long21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_21 <- mean(dt1$asal) 

dt_long$gradient_wet <- 1.10
dt_long$gradient_dry <- 0.854
dt_long$kplant_wet <- 1.23
dt_long$kplant_dry <- 0.449

dt_long$as_mean <- NA

dt_long$as_mean[dt_long$y == 2018] <- long_asal_18*10000
dt_long$as_mean[dt_long$y == 2019] <- long_asal_19*10000
dt_long$as_mean[dt_long$y == 2020] <- long_asal_20*10000
dt_long$as_mean[dt_long$y == 2021] <- long_asal_21*10000

dt_long$gradient_wet_adj <- dt_long$gradient_wet-(0.01*dt_long$h)
dt_long$gradient_dry_adj <- dt_long$gradient_dry-(0.01*dt_long$h)
dt_long$lump_wet <- dt_long$gradient_wet_adj*(1/dt_long$h)*dt_long$as_mean/10000
dt_long$lump_dry <- dt_long$gradient_dry_adj*(1/dt_long$h)*dt_long$as_mean/10000
dt_long$kplant_h <- dt_long$kplant_wet*(1/dt_long$h)
dt_long$path_effs <- dt_long$gradient_wet_adj*(1/dt_long$h)
```

We then combine the selected data into dataframe by year, and then into a single overall dataframe.
```{r dataframe generation - optimal}
dt_all_18 <- rbind(dt_virg18, dt_short18, dt_lob218, dt_lob118, dt_slash18, dt_long18)
dt_all_19 <- rbind(dt_virg19, dt_short19, dt_lob219, dt_lob119, dt_slash19, dt_long19)
dt_all_20 <- rbind(dt_virg20, dt_short20, dt_lob220, dt_lob120, dt_slash20, dt_long20)
dt_all_21 <- rbind(dt_virg21, dt_short21, dt_lob221, dt_lob121, dt_slash21, dt_long21)
dt_all_22 <- rbind(dt_virg22, dt_short22, dt_lob222, dt_lob122, dt_slash22)

dt_all <- rbind(dt_virg, dt_short, dt_lob2, dt_lob1, dt_slash, dt_long)
```

###Establish Limiting Conditions Dataframes
Here, we define the dataframe that we will use to do the same selection for dry conditions. This observational window extends from the beginning of June to the end of September.
```{r dataframe establishment - limiting}
td_final2 <- subset(Complete.Js_QC, Complete.Js_QC$REWAvg < 0.2 & Complete.Js_QC$Day > 151 & Complete.Js_QC$Day < 274 & Complete.Js_QC$VPDz >= 0.8 & Complete.Js_QC$VPDz < 1)
```

We then select the corresponding days and data for this comparison.
```{r dz and rew - limiting df}
yr <- 2018
df <- td_final2[td_final2$Year == yr,]
dd_env18 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(VPDz, na.rm = T), r=mean(REWAvg, na.rm = T))

yr <- 2019
df <- td_final2[td_final2$Year == yr,]
dd_env19 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(VPDz, na.rm = T), r=mean(REWAvg, na.rm = T))

yr <- 2020
df <- td_final2[td_final2$Year == yr,]
dd_env20 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(VPDz, na.rm = T), r=mean(REWAvg, na.rm = T))

yr <- 2021
df <- td_final2[td_final2$Year == yr,]
dd_env21 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(VPDz, na.rm = T), r=mean(REWAvg, na.rm = T))


yr <- 2022
df <- td_final2[td_final2$Year == yr,]
dd_env22 <- group_by(df, Day) %>%
  summarise(y = mean(Year), d=mean(VPDz, na.rm = T), r=mean(REWAvg, na.rm = T))

dd_env <- rbind(dd_env18, dd_env19, dd_env20, dd_env21, dd_env22)

boxplot(dd_env$d~dd_env$y)
```

```{r virginia - limiting df}
spec <- "Virginia"
yr <- 2018
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_virg18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_virg19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_virg20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_virg21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_virg22 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dd_virg <- rbind(dd_virg18, dd_virg19, dd_virg20, dd_virg21, dd_virg22)

dt1 <- group_by(dd_virg18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_18 <- median(dt1$asal)

dt1 <- group_by(dd_virg19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_19 <- median(dt1$asal)

dt1 <- group_by(dd_virg20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_20 <- median(dt1$asal)

dt1 <- group_by(dd_virg21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_21 <- median(dt1$asal) 

dt1 <- group_by(dd_virg22, Day) %>%
  summarise(asal=mean(as, na.rm = T))
virg_asal_22 <- median(dt1$asal) 

dd_virg$gradient_wet <- 1.73
dd_virg$gradient_dry <- 1.25
dd_virg$kplant_wet <- 0.709
dd_virg$kplant_dry <- 0.280

dd_virg$as_mean <- NA

dd_virg$as_mean[dd_virg$y == 2018] <- virg_asal_18*10000
dd_virg$as_mean[dd_virg$y == 2019] <- virg_asal_19*10000
dd_virg$as_mean[dd_virg$y == 2020] <- virg_asal_20*10000
dd_virg$as_mean[dd_virg$y == 2021] <- virg_asal_21*10000
dd_virg$as_mean[dd_virg$y == 2022] <- virg_asal_22*10000

dd_virg$gradient_wet_adj <- dd_virg$gradient_wet-(0.01*dd_virg$h)
dd_virg$gradient_dry_adj <- dd_virg$gradient_dry-(0.01*dd_virg$h)
dd_virg$lump_wet <- dd_virg$gradient_wet_adj*(1/dd_virg$h)*dd_virg$as_mean/10000
dd_virg$lump_dry <- dd_virg$gradient_dry_adj*(1/dd_virg$h)*dd_virg$as_mean/10000
dd_virg$kplant_h <- dd_virg$kplant_dry*(1/dd_virg$h)
dd_virg$path_effs <- dd_virg$gradient_dry_adj*(1/dd_virg$h)
```

```{r shortleaf - limiting df}
spec <- "Shortleaf"
yr <- 2018
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_short18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_short19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_short20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_short21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_short22 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dd_short <- rbind(dd_short18, dd_short19, dd_short20, dd_short21, dd_short22)

dt1 <- group_by(dd_short18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_18 <- median(dt1$asal)

dt1 <- group_by(dd_short19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_19 <- median(dt1$asal)

dt1 <- group_by(dd_short20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_20 <- median(dt1$asal)

dt1 <- group_by(dd_short21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_21 <- median(dt1$asal) 

dt1 <- group_by(dd_short22, Day) %>%
  summarise(asal=mean(as, na.rm = T))
short_asal_22 <- median(dt1$asal) 

dd_short$gradient_wet <- 1.98
dd_short$gradient_dry <- 1.40
dd_short$kplant_wet <- 0.593
dd_short$kplant_dry <- 0.267

dd_short$as_mean <- NA

dd_short$as_mean[dd_short$y == 2018] <- short_asal_18*10000
dd_short$as_mean[dd_short$y == 2019] <- short_asal_19*10000
dd_short$as_mean[dd_short$y == 2020] <- short_asal_20*10000
dd_short$as_mean[dd_short$y == 2021] <- short_asal_21*10000
dd_short$as_mean[dd_short$y == 2022] <- short_asal_22*10000

dd_short$gradient_wet_adj <- dd_short$gradient_wet-(0.01*dd_short$h)
dd_short$gradient_dry_adj <- dd_short$gradient_dry-(0.01*dd_short$h)
dd_short$lump_wet <- dd_short$gradient_wet_adj*(1/dd_short$h)*dd_short$as_mean/10000
dd_short$lump_dry <- dd_short$gradient_dry_adj*(1/dd_short$h)*dd_short$as_mean/10000
dd_short$kplant_h <- dd_short$kplant_dry*(1/dd_short$h)
dd_short$path_effs <- dd_short$gradient_dry_adj*(1/dd_short$h)
```

```{r loblolly2 - limiting df}
spec <- "Loblolly2"
yr <- 2018
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob218 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob219 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob220 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob221 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob222 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dd_lob2 <- rbind(dd_lob218, dd_lob219, dd_lob220, dd_lob221, dd_lob222)

dt1 <- group_by(dd_lob218, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_18 <- median(dt1$asal)

dt1 <- group_by(dd_lob219, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_19 <- median(dt1$asal)

dt1 <- group_by(dd_lob220, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_20 <- median(dt1$asal)

dt1 <- group_by(dd_lob221, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_21 <- median(dt1$asal) 

dt1 <- group_by(dd_lob222, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob2_asal_22 <- median(dt1$asal) 

dd_lob2$gradient_wet <- 1.75
dd_lob2$gradient_dry <- 1.15
dd_lob2$kplant_wet <- 0.776
dd_lob2$kplant_dry <- 0.345

dd_lob2$as_mean <- NA

dd_lob2$as_mean[dd_lob2$y == 2018] <- lob2_asal_18*10000
dd_lob2$as_mean[dd_lob2$y == 2019] <- lob2_asal_19*10000
dd_lob2$as_mean[dd_lob2$y == 2020] <- lob2_asal_20*10000
dd_lob2$as_mean[dd_lob2$y == 2021] <- lob2_asal_21*10000
dd_lob2$as_mean[dd_lob2$y == 2022] <- lob2_asal_22*10000

dd_lob2$gradient_wet_adj <- dd_lob2$gradient_wet-(0.01*dd_lob2$h)
dd_lob2$gradient_dry_adj <- dd_lob2$gradient_dry-(0.01*dd_lob2$h)
dd_lob2$lump_wet <- dd_lob2$gradient_wet_adj*(1/dd_lob2$h)*dd_lob2$as_mean/10000
dd_lob2$lump_dry <- dd_lob2$gradient_dry_adj*(1/dd_lob2$h)*dd_lob2$as_mean/10000
dd_lob2$kplant_h <- dd_lob2$kplant_dry*(1/dd_lob2$h)
dd_lob2$path_effs <- dd_lob2$gradient_dry_adj*(1/dd_lob2$h)
```

```{r loblolly1 - limiting df}
spec <- "Loblolly1"
yr <- 2018
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob118 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob119 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob120 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob121 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_lob122 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dd_lob1 <- rbind(dd_lob118, dd_lob119, dd_lob120, dd_lob121, dd_lob122)

dt1 <- group_by(dd_lob118, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_18 <- median(dt1$asal)

dt1 <- group_by(dd_lob119, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_19 <- median(dt1$asal)

dt1 <- group_by(dd_lob120, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_20 <- median(dt1$asal)

dt1 <- group_by(dd_lob121, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_21 <- median(dt1$asal) 

dt1 <- group_by(dd_lob122, Day) %>%
  summarise(asal=mean(as, na.rm = T))
lob1_asal_22 <- median(dt1$asal) 

dd_lob1$gradient_wet <- 1.57
dd_lob1$gradient_dry <- 1.06
dd_lob1$kplant_wet <- 0.825
dd_lob1$kplant_dry <- 0.390

dd_lob1$as_mean <- NA

dd_lob1$as_mean[dd_lob1$y == 2018] <- lob1_asal_18*10000
dd_lob1$as_mean[dd_lob1$y == 2019] <- lob1_asal_19*10000
dd_lob1$as_mean[dd_lob1$y == 2020] <- lob1_asal_20*10000
dd_lob1$as_mean[dd_lob1$y == 2021] <- lob1_asal_21*10000
dd_lob1$as_mean[dd_lob1$y == 2022] <- lob1_asal_22*10000

dd_lob1$gradient_wet_adj <- dd_lob1$gradient_wet-(0.01*dd_lob1$h)
dd_lob1$gradient_dry_adj <- dd_lob1$gradient_dry-(0.01*dd_lob1$h)
dd_lob1$lump_wet <- dd_lob1$gradient_wet_adj*(1/dd_lob1$h)*dd_lob1$as_mean/10000
dd_lob1$lump_dry <- dd_lob1$gradient_dry_adj*(1/dd_lob1$h)*dd_lob1$as_mean/10000
dd_lob1$kplant_h <- dd_lob1$kplant_dry*(1/dd_lob1$h)
dd_lob1$path_effs <- dd_lob1$gradient_dry_adj*(1/dd_lob1$h)
```

```{r slash - limiting df}
spec <- "Slash"
yr <- 2018
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_slash18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_slash19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_slash20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_slash21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2022
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_slash22 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dd_slash <- rbind(dd_slash18, dd_slash19, dd_slash20, dd_slash21, dd_slash22)

dt1 <- group_by(dd_slash18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_18 <- median(dt1$asal)

dt1 <- group_by(dd_slash19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_19 <- median(dt1$asal)

dt1 <- group_by(dd_slash20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_20 <- median(dt1$asal)

dt1 <- group_by(dd_slash21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_21 <- median(dt1$asal) 

dt1 <- group_by(dd_slash22, Day) %>%
  summarise(asal=mean(as, na.rm = T))
slash_asal_22 <- median(dt1$asal) 

dd_slash$gradient_wet <- 1.52
dd_slash$gradient_dry <- 1.11
dd_slash$kplant_wet <- 0.923
dd_slash$kplant_dry <- 0.339

dd_slash$as_mean <- NA

dd_slash$as_mean[dd_slash$y == 2018] <- slash_asal_18*10000
dd_slash$as_mean[dd_slash$y == 2019] <- slash_asal_19*10000
dd_slash$as_mean[dd_slash$y == 2020] <- slash_asal_20*10000
dd_slash$as_mean[dd_slash$y == 2021] <- slash_asal_21*10000
dd_slash$as_mean[dd_slash$y == 2022] <- slash_asal_22*10000

dd_slash$gradient_wet_adj <- dd_slash$gradient_wet-(0.01*dd_slash$h)
dd_slash$gradient_dry_adj <- dd_slash$gradient_dry-(0.01*dd_slash$h)
dd_slash$lump_wet <- dd_slash$gradient_wet_adj*(1/dd_slash$h)*dd_slash$as_mean/10000
dd_slash$lump_dry <- dd_slash$gradient_dry_adj*(1/dd_slash$h)*dd_slash$as_mean/10000
dd_slash$kplant_h <- dd_slash$kplant_dry*(1/dd_slash$h)
dd_slash$path_effs <- dd_slash$gradient_dry_adj*(1/dd_slash$h)
```

```{r longleaf - limiting df}
spec <- "Longleaf"
yr <- 2018
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_long18 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2019
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_long19 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2020
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_long20 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

yr <- 2021
idx <- td_final2$Day[td_final2$Year == yr & td_final2$Species == spec]

data <- subset(Complete.Js_QC, Complete.Js_QC$Species == spec & Complete.Js_QC$Year == yr)

data <- data[data$Day %in% idx, ]

df <- data
dd_long21 <- group_by(df, Day) %>%
  summarise(d = mean(VPDz), r =mean(REWAvg),
            y = mean(Year), s = first(Species),
            j=mean(Out.Js, na.rm = T), e=mean(El_NewRes, na.rm = T),
            j.sd=sd(Out.Js, na.rm = T), e.sd=sd(El_NewRes, na.rm = T),
            as=mean(SapLeaf, na.rm = T), h=mean(Height, na.rm = T), 
            n = mean(NeedleLength))

dd_long <- rbind(dd_long18, dd_long19, dd_long20, dd_long21)

dt1 <- group_by(dd_long18, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_18 <- median(dt1$asal)

dt1 <- group_by(dd_long19, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_19 <- median(dt1$asal)

dt1 <- group_by(dd_long20, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_20 <- median(dt1$asal)

dt1 <- group_by(dd_long21, Day) %>%
  summarise(asal=mean(as, na.rm = T))
long_asal_21 <- median(dt1$asal) 

dd_long$gradient_wet <- 1.10
dd_long$gradient_dry <- 0.854
dd_long$kplant_wet <- 1.23
dd_long$kplant_dry <- 0.449

dd_long$as_mean <- NA

dd_long$as_mean[dd_long$y == 2018] <- long_asal_18*10000
dd_long$as_mean[dd_long$y == 2019] <- long_asal_19*10000
dd_long$as_mean[dd_long$y == 2020] <- long_asal_20*10000
dd_long$as_mean[dd_long$y == 2021] <- long_asal_21*10000

dd_long$gradient_wet_adj <- dd_long$gradient_wet-(0.01*dd_long$h)
dd_long$gradient_dry_adj <- dd_long$gradient_dry-(0.01*dd_long$h)
dd_long$lump_wet <- dd_long$gradient_wet_adj*(1/dd_long$h)*dd_long$as_mean/10000
dd_long$lump_dry <- dd_long$gradient_dry_adj*(1/dd_long$h)*dd_long$as_mean/10000
dd_long$kplant_h <- dd_long$kplant_dry*(1/dd_long$h)
dd_long$path_effs <- dd_long$gradient_dry_adj*(1/dd_long$h)
```

We then combine the selected data into dataframe by year, and then into a single overall dataframe.
```{r dataframe generation - limiting}
dd_all_18 <- rbind(dd_virg18, dd_short18, dd_lob218, dd_lob118, dd_slash18, dd_long18)
dd_all_19 <- rbind(dd_virg19, dd_short19, dd_lob219, dd_lob119, dd_slash19, dd_long19)
dd_all_20 <- rbind(dd_virg20, dd_short20, dd_lob220, dd_lob120, dd_slash20, dd_long20)
dd_all_21 <- rbind(dd_virg21, dd_short21, dd_lob221, dd_lob121, dd_slash21, dd_long21)
dd_all_22 <- rbind(dd_virg22, dd_short22, dd_lob222, dd_lob122, dd_slash22)

dd_all <- rbind(dd_virg, dd_short, dd_lob2, dd_lob1, dd_slash, dd_long)
```

We then combine all data from both selections into dataframes. We identify conditions, summarize by condition and year, and then combine the data.
```{r combined summarized dataframes}
dt_env$Condition <- "Wet"
dt_virg$Condition <- "Wet"
dt_short$Condition <- "Wet"
dt_lob2$Condition <- "Wet"
dt_lob1$Condition <- "Wet"
dt_slash$Condition <- "Wet"
dt_long$Condition <- "Wet"

dd_env$Condition <- "Dry"
dd_virg$Condition <- "Dry"
dd_short$Condition <- "Dry"
dd_lob2$Condition <- "Dry"
dd_lob1$Condition <- "Dry"
dd_slash$Condition <- "Dry"
dd_long$Condition <- "Dry"

df_env <- rbind(dt_env, dd_env)
df_virg <- rbind(dt_virg, dd_virg)
df_short <- rbind(dt_short, dd_short)
df_lob2 <- rbind(dt_lob2, dd_lob2)
df_lob1 <- rbind(dt_lob1, dd_lob1)
df_slash <- rbind(dt_slash, dd_slash)
df_long <- rbind(dt_long, dd_long)

df_all <- rbind(df_virg, df_short, df_lob2, df_lob1, df_slash, df_long)

dd_env_sum <- group_by(dd_env, y) %>%
  summarise(dmean=mean(d, na.rm = T), rmean=mean(r, na.rm = T), dse=se(d, na.rm = T), rse=se(r, na.rm = T))
dd_env_sum$Condition <- "Dry"

dd_virg_sum <- group_by(dd_virg, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e, na.rm = T), as=mean(as_mean), h=mean(h), lump=mean(lump_dry), k_h=mean(kplant_h), grad=mean(gradient_dry_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T), n=mean(n))
dd_virg_sum$Condition <- "Dry"

dd_short_sum <- group_by(dd_short, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T), n=mean(n))
dd_short_sum$Condition <- "Dry"

dd_lob2_sum <- group_by(dd_lob2, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T), n=mean(n))
dd_lob2_sum$Condition <- "Dry"

dd_lob1_sum <- group_by(dd_lob1, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T), n=mean(n))
dd_lob1_sum$Condition <- "Dry"

dd_slash_sum <- group_by(dd_slash, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T), n=mean(n))
dd_slash_sum$Condition <- "Dry"

dd_long_sum <- group_by(dd_long, y) %>%
  summarise(species = first(s), js=mean(j, na.rm = T), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T), n=mean(n))
dd_long_sum$Condition <- "Dry"

dd_sum <- rbind(dd_virg_sum, dd_short_sum, dd_lob2_sum, dd_lob1_sum, dd_slash_sum, dd_long_sum)

dt_env_sum <- group_by(dt_env, y) %>%
  summarise(dmean=mean(d, na.rm = T), rmean=mean(r, na.rm = T), dse=se(d, na.rm = T), rse=se(r, na.rm = T))
dt_env_sum$Condition <- "Wet"

dt_virg_sum <- group_by(dt_virg, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T),  n=mean(n))
dt_virg_sum$Condition <- "Wet"

dt_short_sum <- group_by(dt_short, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T),  n=mean(n))
dt_short_sum$Condition <- "Wet"

dt_lob2_sum <- group_by(dt_lob2, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T),  n=mean(n))
dt_lob2_sum$Condition <- "Wet"

dt_lob1_sum <- group_by(dt_lob1, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T),  n=mean(n))
dt_lob1_sum$Condition <- "Wet"

dt_slash_sum <- group_by(dt_slash, y) %>%
  summarise(species = first(s), js=mean(j), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T),  n=mean(n))
dt_slash_sum$Condition <- "Wet"

dt_long_sum <- group_by(dt_long, y) %>%
  summarise(species = first(s), js=mean(j, na.rm = T), el=mean(e), as=mean(as_mean), h=mean(h), lump=mean(lump_wet), k_h=mean(kplant_h), grad=mean(gradient_wet_adj), path=mean(path_effs), d=mean(d, na.rm = T), r=mean(r, na.rm = T), jse=se(j, na.rm = T), ese=se(e, na.rm = T),  n=mean(n))
dt_long_sum$Condition <- "Wet"

dt_sum <- rbind(dt_virg_sum, dt_short_sum, dt_lob2_sum, dt_lob1_sum, dt_slash_sum, dt_long_sum)

df_env_sum <- rbind(dt_env_sum, dd_env_sum)
df_virg_sum <- rbind(dt_virg_sum, dd_virg_sum) 
df_short_sum <- rbind(dt_short_sum, dd_short_sum) 
df_lob2_sum <- rbind(dt_lob2_sum, dd_lob2_sum) 
df_lob1_sum <- rbind(dt_lob1_sum, dd_lob1_sum) 
df_slash_sum <- rbind(dt_slash_sum, dd_slash_sum) 
df_long_sum <- rbind(dt_long_sum, dd_long_sum) 

df_sum <- rbind(df_virg_sum, df_short_sum, df_lob2_sum, df_lob1_sum, df_slash_sum, df_long_sum)
```

### Data Analysis
First, we look at the trajectory of Dz and REW over the course of the study.
```{r dz and time, dz and js/el}
#Start with Dry Conditions
ggplot(dd_env, aes(x = y, y = d)) + geom_point() + lims(y = c(0, 2)) + geom_smooth(method = 'lm')

plot(dd_env$y, dd_env$r, pch = 19, ylim = c(0, 2))
abline(lm(dd_env$r~dd_env$y), col = 'red')
summary(lm(dd_env$r~dd_env$y))

t <- aov(d~as.factor(y), data = dd_env)
summary(t)
tukey <- TukeyHSD(t)
cld <- multcompLetters4(t, tukey)

#Check for each species.
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$d[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Dz (kPa)", ylim = c(0, 1.5))
mod1 <- lm(d~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

#Wet Conditions
ggplot(dt_env, aes(x = y, y = d)) + geom_point() + lims(y = c(0, 2)) + geom_smooth(method = 'lm')

plot(dt_env_sum$y, dt_env_sum$dmean, pch = 19, ylim = c(0, 2))
abline(lm(dt_env_sum$dmean~dt_env_sum$y), col = 'red')
summary(lm(dt_env_sum$dmean~dt_env_sum$y))

t <- aov(d~as.factor(y), data = dt_env)
summary(t)
tukey <- TukeyHSD(t)
cld <- multcompLetters4(t, tukey)

#Check for each species.
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dd_all$y[dd_all$s == spec], dd_all$d[dd_all$s == spec], 
     pch = 19, xlab = "", ylab = "Dz (kPa)", ylim = c(0, 1.5))
mod1 <- lm(d~y, data = dd_all[dd_all$s == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))
```

```{r rew and time, rew and js/el}
#Start with Dry Conditions
ggplot(dd_env, aes(x = y, y = r)) + geom_point() + lims(y = c(0, 0.3)) + geom_smooth(method = 'lm')

plot(dd_env_sum$y, dd_env_sum$rmean, pch = 19, ylim = c(0, 0.3))
abline(lm(dd_env_sum$rmean~dd_env_sum$y), col = 'red')
summary(lm(dd_env_sum$rmean~dd_env_sum$y))

t <- aov(r~as.factor(y), data = dd_env)
summary(t)
tukey <- TukeyHSD(t)
cld <- multcompLetters4(t, tukey)

#Check for each species.
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$r[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "REW", ylim = c(0, 0.3))
mod1 <- lm(r~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

#Wet Conditions
ggplot(dt_env, aes(x = y, y = r)) + geom_point() + lims(y = c(0, 0.3)) + geom_smooth(method = 'lm')

plot(dt_env_sum$y, dt_env_sum$rmean, pch = 19, ylim = c(0, 0.3))
abline(lm(dt_env_sum$rmean~dt_env_sum$y), col = 'red')
summary(lm(dt_env_sum$rmean~dt_env_sum$y))

t <- aov(r~as.factor(y), data = dt_env)
summary(t)
tukey <- TukeyHSD(t)
cld <- multcompLetters4(t, tukey)

#Check for each species.
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$r[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "REW", ylim = c(0, 0.3))
mod1 <- lm(r~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))
```

Then, we look to see if Js and El decline over time for each species.
```{r js - wet and dry}
#Dry Conditions
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$js[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Shortleaf"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$js[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly2"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$js[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly1"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$js[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Slash"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$js[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Longleaf"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$js[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

#Wet Conditions
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$js[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Shortleaf"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$js[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly2"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$js[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly1"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$js[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Slash"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$js[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Longleaf"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$js[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "Js", ylim = c(0, 2))
mod1 <- lm(js~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))
```

```{r el - wet and dry}
summary(lm(j~y, data = dt_all))
summary(lm(e~y, data = dt_all))

#Does 2018 drive the relationship?
summary(lm(j~y, data = dd_all[dd_all$y != 2018,]))
summary(lm(e~y, data = dd_all[dd_all$y != 2018,]))


#Dry Conditions
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$el[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Shortleaf"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$el[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly2"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$el[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly1"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$el[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Slash"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$el[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Longleaf"
par(mfrow = c(1,1))
plot(dd_sum$y[dd_sum$species == spec], dd_sum$el[dd_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dd_sum[dd_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

#Wet Conditions
spec <- "Virginia"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$el[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Shortleaf"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$el[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly2"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$el[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Loblolly1"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$el[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Slash"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$el[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))

spec <- "Longleaf"
par(mfrow = c(1,1))
plot(dt_sum$y[dt_sum$species == spec], dt_sum$el[dt_sum$species == spec], 
     pch = 19, xlab = "", ylab = "el", ylim = c(0, 2))
mod1 <- lm(el~y, data = dt_sum[dt_sum$species == spec,])
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+(coefficients(mod1)[2]*2022))/
  (coefficients(mod1)[1]+(coefficients(mod1)[2]*2018))
```

Check the relationship between water uptake and needle length.
```{r js and el - needle}
plot((dt_all$j~dt_all$n), pch = 19, ylim = c(0,4))
abline(lm(dt_all$j~dt_all$n), col = 'red')
summary(lm(dt_all$j~dt_all$n))

plot((dt_all$e~dt_all$n), pch = 19, ylim = c(0,4))
abline(lm(dt_all$e~dt_all$n), col = 'red')
summary(lm(dt_all$e~dt_all$n))


mod <- aov((dd_all$j~dd_all$s))
Anova(mod, type = 3)
TukeyHSD(mod)

dd_all2 <- subset(dd_all, dd_all$y > 2018)
plot((dd_all$j~dd_all$n), pch = 19, ylim = c(0,4))
abline(lm(dd_all$j~dd_all$n), col = 'red')
summary(lm(dd_all$j~dd_all$n))


dd_all$e[dd_all$s == "Shortleaf" & dd_all$y == 2022 & dd_all$Day == 170] <- NA
dd_all$e[dd_all$s == "Shortleaf" & dd_all$y == 2022 & dd_all$Day == 171] <- NA
plot((dd_all$e~dd_all$n), pch = 19, ylim = c(0,1.5))
abline(lm(dd_all$e~dd_all$n), col = 'red')
summary(lm(dd_all$e~dd_all$n))`
```

Explore the key hydraulic relationships.
```{r key hydraulic relationships}
#Virginia
dt <- dt_virg_sum
par(mfrow = c(1,1))
plot(dt$grad~dt$y, xlab = "", ylab = "Driving Force (-MPa)")
mod1 <- lm(dt$grad~dt$y)
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+coefficients(mod1)[2]*2022)/
  (coefficients(mod1)[1]+coefficients(mod1)[2]*2018)

plot(dt$as~dt$y, xlab = "", ylab = "Median AsAl (cm2 m-2)")
mod2 <- lm(dt$as~dt$y)
abline(mod2, col = 'red')
summary(mod2)
(coefficients(mod2)[1]+coefficients(mod2)[2]*2022)/
  (coefficients(mod2)[1]+coefficients(mod2)[2]*2018)

plot((1/dt$h)~dt$y, xlab = "", ylab = "Pathlength (m-1)")
mod3 <- lm((1/dt$h)~dt$y)
abline(mod3, col = 'red')
summary(mod3)
(coefficients(mod3)[1]+coefficients(mod3)[2]*2022)/
  (coefficients(mod3)[1]+coefficients(mod3)[2]*2018)

plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

dt <- dd_virg_sum
plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

#Shortleaf
dt <- dt_short_sum

par(mfrow = c(1,1))
plot(dt$grad~dt$y, xlab = "", ylab = "Driving Force (-MPa)")
mod1 <- lm(dt$grad~dt$y)
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+coefficients(mod1)[2]*2022)/
  (coefficients(mod1)[1]+coefficients(mod1)[2]*2018)

plot(dt$as~dt$y, xlab = "", ylab = "Median AsAl (cm2 m-2)")
mod2 <- lm(dt$as~dt$y)
abline(mod2, col = 'red')
summary(mod2)
(coefficients(mod2)[1]+coefficients(mod2)[2]*2022)/
  (coefficients(mod2)[1]+coefficients(mod2)[2]*2018)

plot((1/dt$h)~dt$y, xlab = "", ylab = "Pathlength (m-1)")
mod3 <- lm((1/dt$h)~dt$y)
abline(mod3, col = 'red')
summary(mod3)
(coefficients(mod3)[1]+coefficients(mod3)[2]*2022)/
  (coefficients(mod3)[1]+coefficients(mod3)[2]*2018)

plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

dt <- dd_short_sum
plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

#Loblolly2
dt <- dt_lob2_sum

par(mfrow = c(1,1))
plot(dt$grad~dt$y, xlab = "", ylab = "Driving Force (-MPa)")
mod1 <- lm(dt$grad~dt$y)
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+coefficients(mod1)[2]*2022)/
  (coefficients(mod1)[1]+coefficients(mod1)[2]*2018)

plot(dt$as~dt$y, xlab = "", ylab = "Median AsAl (cm2 m-2)")
mod2 <- lm(dt$as~dt$y)
abline(mod2, col = 'red')
summary(mod2)
(coefficients(mod2)[1]+coefficients(mod2)[2]*2022)/
  (coefficients(mod2)[1]+coefficients(mod2)[2]*2018)

plot((1/dt$h)~dt$y, xlab = "", ylab = "Pathlength (m-1)")
mod3 <- lm((1/dt$h)~dt$y)
abline(mod3, col = 'red')
summary(mod3)
(coefficients(mod3)[1]+coefficients(mod3)[2]*2022)/
  (coefficients(mod3)[1]+coefficients(mod3)[2]*2018)

plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

dt <- dd_lob2_sum
plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

#Loblolly1
dt <- dt_lob1_sum

par(mfrow = c(1,1))
plot(dt$grad~dt$y, xlab = "", ylab = "Driving Force (-MPa)")
mod1 <- lm(dt$grad~dt$y)
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+coefficients(mod1)[2]*2022)/
  (coefficients(mod1)[1]+coefficients(mod1)[2]*2018)

plot(dt$as~dt$y, xlab = "", ylab = "Median AsAl (cm2 m-2)")
mod2 <- lm(dt$as~dt$y)
abline(mod2, col = 'red')
summary(mod2)
(coefficients(mod2)[1]+coefficients(mod2)[2]*2022)/
  (coefficients(mod2)[1]+coefficients(mod2)[2]*2018)

plot((1/dt$h)~dt$y, xlab = "", ylab = "Pathlength (m-1)")
mod3 <- lm((1/dt$h)~dt$y)
abline(mod3, col = 'red')
summary(mod3)
(coefficients(mod3)[1]+coefficients(mod3)[2]*2022)/
  (coefficients(mod3)[1]+coefficients(mod3)[2]*2018)

plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

dt <- dd_lob1_sum
plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

#Slash
dt <- dt_slash_sum

par(mfrow = c(1,1))
plot(dt$grad~dt$y, xlab = "", ylab = "Driving Force (-MPa)")
mod1 <- lm(dt$grad~dt$y)
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+coefficients(mod1)[2]*2022)/
  (coefficients(mod1)[1]+coefficients(mod1)[2]*2018)

plot(dt$as~dt$y, xlab = "", ylab = "Median AsAl (cm2 m-2)")
mod2 <- lm(dt$as~dt$y)
abline(mod2, col = 'red')
summary(mod2)
(coefficients(mod2)[1]+coefficients(mod2)[2]*2022)/
  (coefficients(mod2)[1]+coefficients(mod2)[2]*2018)

plot((1/dt$h)~dt$y, xlab = "", ylab = "Pathlength (m-1)")
mod3 <- lm((1/dt$h)~dt$y)
abline(mod3, col = 'red')
summary(mod3)
(coefficients(mod3)[1]+coefficients(mod3)[2]*2022)/
  (coefficients(mod3)[1]+coefficients(mod3)[2]*2018)

plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

dt <- dd_slash_sum
plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2022)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

#Longleaf
dt <- dt_long_sum

par(mfrow = c(1,1))
plot(dt$grad~dt$y, xlab = "", ylab = "Driving Force (-MPa)")
mod1 <- lm(dt$grad~dt$y)
abline(mod1, col = 'red')
summary(mod1)
(coefficients(mod1)[1]+coefficients(mod1)[2]*2021)/
  (coefficients(mod1)[1]+coefficients(mod1)[2]*2018)

plot(dt$as~dt$y, xlab = "", ylab = "Median AsAl (cm2 m-2)")
mod2 <- lm(dt$as~dt$y)
abline(mod2, col = 'red')
summary(mod2)
(coefficients(mod2)[1]+coefficients(mod2)[2]*2021)/
  (coefficients(mod2)[1]+coefficients(mod2)[2]*2018)

plot((1/dt$h)~dt$y, xlab = "", ylab = "Pathlength (m-1)")
mod3 <- lm((1/dt$h)~dt$y)
abline(mod3, col = 'red')
summary(mod3)
(coefficients(mod3)[1]+coefficients(mod3)[2]*2021)/
  (coefficients(mod3)[1]+coefficients(mod3)[2]*2018)

plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2021)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)

dt <- dd_long_sum
plot(dt$lump~dt$y, xlab = "", ylab = "Lumped Parameter")
mod4 <- lm(dt$lump~dt$y)
abline(mod4, col = 'red')
summary(mod4)
(coefficients(mod4)[1]+coefficients(mod4)[2]*2021)/
  (coefficients(mod4)[1]+coefficients(mod4)[2]*2018)
```

Then we develop the models.
```{r model fitting}
#write.csv(dt_sum, "SummaryDF.csv")
dt_sum_adj <- read.csv("SummaryDF.csv")

#write.csv(dd_sum, "SummaryDF2.csv")
dd_sum_adj <- read.csv("SummaryDF2.csv")

#write.csv(df_sum, "SummaryDF3.csv")
df_sum_adj <- read.csv("SummaryDF3.csv")

#From here, I go into Excel and create the columns h_rel and lump_rel, the relative values of height and the lumped parameter when compared to their values in 2018.

#Wet conditions, variables driving Js
mod <- (aov(js~species, data = dt_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~species+d+path, data = dt_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~h_rel, data = dt_sum_adj))
Anova(mod, type = "3")

summary(lm(js~h_rel, data = dt_sum_adj))

#Wet conditions, variables driving El
mod <- (aov(el~species, data = dt_sum_adj))
Anova(mod, type = "3")

mod <- (aov(el~species+d+path, data = dt_sum_adj))
Anova(mod, type = "3")

mod <- (aov(el~h_rel+species, data = dt_sum_adj))
Anova(mod, type = "3")

summary(lm(el~h_rel, data = dt_sum_adj))

##repeat with the lumped parameter
mod <- (aov(el~species+lump_rel, data = dt_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~lump_rel, data = dt_sum_adj))
Anova(mod, type = "3")

#Final Model for Js
summary(lm(el~lump_rel+d+species, data = dt_sum_adj))

mod <- (aov(el~species+lump_rel+d, data = dt_sum_adj))
Anova(mod, type = "3")

mod <- (aov(el~species+lump_rel, data = dt_sum_adj))
Anova(mod, type = "3")

#Final Model
summary(lm(el~species+lump_rel, data = dt_sum_adj))

dt_sum_adj$Species[dt_sum_adj$species == "Virginia" | dt_sum_adj$species == "Slash" | dt_sum_adj$species == "Shortleaf"] <- "Virginia, Shortleaf, and Slash" 
dt_sum_adj$Species[dt_sum_adj$species == "Loblolly2" | dt_sum_adj$species == "Loblolly1" | dt_sum_adj$species == "Longleaf"] <- "Loblolly and Longleaf"
summary(lm(el~Species+lump_rel, data = dt_sum_adj))

###Repeat with Dry Conditions
mod <- (aov(js~species, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~species+d+path+, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~d+path, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~lump_rel+d, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(el~lump_rel+species, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~d+lump_rel, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(js~lump_rel, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(el~species+d+lump_rel, data = dd_sum_adj))
Anova(mod, type = "3")

mod <- (aov(el~lump_rel+species, data = dd_sum_adj))
Anova(mod, type = "3")

summary(lm(el~lump_rel+species, data = dd_sum_adj))

dd_sum_adj$Species[dd_sum_adj$species == "Virginia" | dd_sum_adj$species == "Slash" | dd_sum_adj$species == "Shortleaf"] <- "Virginia, Shortleaf, and Slash" 
dd_sum_adj$Species[dd_sum_adj$species == "Loblolly2" | dd_sum_adj$species == "Loblolly1" | dd_sum_adj$species == "Longleaf"] <- "Loblolly and Longleaf"
summary(lm(el~Species+lump_rel, data = dt_sum_adj))
```

Summarize As/Al data and explore relationships.
```{r revisiting the question of as/al}
dt1 <- group_by(dt_virg18, Day) %>%
  summarise(asal=first(as))
virg_as_18 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_virg19, Day) %>%
  summarise(asal=first(as))
virg_as_19 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_virg20, Day) %>%
  summarise(asal=first(as))
virg_as_20 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_virg21, Day) %>%
  summarise(asal=first(as))
virg_as_21 <- first(dt1$asal)*10000  

dt1 <- group_by(dt_virg22, Day) %>%
  summarise(asal=first(as))
virg_as_22 <- first(dt1$asal)*10000  

##short
dt1 <- group_by(dt_short18, Day) %>%
  summarise(asal=first(as))
short_as_18 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_short19, Day) %>%
  summarise(asal=first(as))
short_as_19 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_short20, Day) %>%
  summarise(asal=first(as))
short_as_20 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_short21, Day) %>%
  summarise(asal=first(as))
short_as_21 <- first(dt1$asal)*10000  

dt1 <- group_by(dt_short22, Day) %>%
  summarise(asal=first(as))
short_as_22 <- first(dt1$asal)*10000  

##lob2
dt1 <- group_by(dt_lob218, Day) %>%
  summarise(asal=first(as))
lob2_as_18 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_lob219, Day) %>%
  summarise(asal=first(as))
lob2_as_19 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_lob220, Day) %>%
  summarise(asal=first(as))
lob2_as_20 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_lob221, Day) %>%
  summarise(asal=first(as))
lob2_as_21 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_lob222, Day) %>%
  summarise(asal=first(as))
lob2_as_22 <- first(dt1$asal)*10000  

#lob1
dt1 <- group_by(dt_lob118, Day) %>%
  summarise(asal=first(as))
lob1_as_18 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_lob119, Day) %>%
  summarise(asal=first(as))
lob1_as_19 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_lob120, Day) %>%
  summarise(asal=first(as))
lob1_as_20 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_lob121, Day) %>%
  summarise(asal=first(as))
lob1_as_21 <- first(dt1$asal)*10000  

dt1 <- group_by(dt_lob122, Day) %>%
  summarise(asal=first(as))
lob1_as_22 <- first(dt1$asal)*10000  

#slash
dt1 <- group_by(dt_slash18, Day) %>%
  summarise(asal=first(as))
slash_as_18 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_slash19, Day) %>%
  summarise(asal=first(as))
slash_as_19 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_slash20, Day) %>%
  summarise(asal=first(as))
slash_as_20 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_slash21, Day) %>%
  summarise(asal=first(as))
slash_as_21 <- first(dt1$asal)*10000  

dt1 <- group_by(dt_slash22, Day) %>%
  summarise(asal=first(as))
slash_as_22 <- first(dt1$asal) *10000 

#long
dt1 <- group_by(dt_long18, Day) %>%
  summarise(asal=first(as))
long_as_18 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_long19, Day) %>%
  summarise(asal=first(as))
long_as_19 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_long20, Day) %>%
  summarise(asal=first(as))
long_as_20 <- first(dt1$asal)*10000 

dt1 <- group_by(dt_long21, Day) %>%
  summarise(asal=first(as))
long_as_21 <- first(dt1$asal)*10000 

virg_y <- ((virg_as_22-virg_as_18)/
  (dt_virg_sum$h[dt_virg_sum$y == 2022]-dt_virg_sum$h[dt_virg_sum$y == 2018]))
virg_x <- 7.51

short_y <- ((short_as_22-short_as_18)/
  (dt_short_sum$h[dt_short_sum$y == 2022]-dt_short_sum$h[dt_short_sum$y == 2018]))
short_x <- 9.28

lob2_y <- ((lob2_as_22-lob2_as_18)/
  (dt_lob2_sum$h[dt_lob2_sum$y == 2022]-dt_lob2_sum$h[dt_lob2_sum$y == 2018]))
lob2_x <- 17.32

lob1_y <- ((lob1_as_22-lob1_as_18)/
  (dt_lob1_sum$h[dt_lob1_sum$y == 2022]-dt_lob1_sum$h[dt_lob1_sum$y == 2018]))
lob1_x <- 19.69

slash_y <- ((slash_as_22-slash_as_18)/
  (dt_slash_sum$h[dt_slash_sum$y == 2022]-dt_slash_sum$h[dt_slash_sum$y == 2018]))
slash_x <- 23.23

long_y <- ((long_as_21-long_as_18)/
  (dt_long_sum$h[dt_long_sum$y == 2021]-dt_long_sum$h[dt_long_sum$y == 2018]))
long_x <- 34.59

comp_y_start <- c(virg_y, short_y, lob2_y, lob1_y, slash_y, long_y)
comp_y_median <- c(virg_y, short_y, lob2_y, lob1_y, slash_y, long_y)
needle_x <- c(virg_x, short_x, lob2_x, lob1_x, slash_x, long_x)

plot(needle_x, comp_y_median, pch = 19)
abline(lm(comp_y_median~needle_x), col = 'red')


summary(lm(comp_y_start~needle_x))
summary(lm(comp_y_median~needle_x))
summary(lm(comp_y_mean~needle_x))

fig7_df <- data.frame(Needle = needle_x, Compensation_Mean = comp_y_mean,
Compensation_Median = comp_y_median, Compensation_Start = comp_y_start,
Species = c("Virginia", "Shortleaf", "Loblolly2", "Loblolly1", "Slash", "Longleaf"))

x <- seq(7, 35, 0.001)
fig7_line <- data.frame(X = x, Line_Mean = (0.0580633-0.0029300*x), Line_Median = (0.0558298-0.0029157*x),
                        Line_Start = (0.152461-0.006304*x), Species = NA)

fig7a <- ggplot(fig7_df, aes(x = Needle, y = Compensation_Mean, col = Species)) + 
  geom_point(size = 5) + 
  scale_color_discrete(type = c(lob2fill, lob1fill, longfill, shortleaffill, slashfill, virginiafill)) + 
  theme_few() + theme(legend.position = 'none') + 
  annotate('text', x = 10, y = 0.05, label = bquote(R^{2} ~ "= 0.61"), cex = 6) + 
  geom_line(data = fig7_line, aes(x = X, y = Line_Mean))  + 
  annotate('text', x = 28, y = -0.035, label = "p = 0.041", cex = 4) + 
  labs(x = "Needle Length (cm)", y = bquote("Δ Mean" ~ A[S] ~ "/" ~ A[L] ~ ": Δ Height"~ "(" ~ cm^{2} ~ m^{-2} ~ ")"))

fig7b <- ggplot(fig7_df, aes(x = Needle, y = Compensation_Median, col = Species)) + 
  geom_point(size = 5) + 
  scale_color_discrete(type = c(lob2fill, lob1fill, longfill, shortleaffill, slashfill, virginiafill)) + 
  theme_few() + theme(legend.position = 'none') + 
  annotate('text', x = 32, y = 0.05, label = bquote(R^{2} ~ "= 0.81"), cex = 6) + 
  geom_line(data = fig7_line, aes(x = X, y = Line_Median))  + 
  annotate('text', x = 28, y = -0.035, label = "p = 0.01", cex = 4) + 
  labs(x = "Needle Length (cm)", y = bquote("Δ Median" ~ A[S] ~ "/" ~ A[L] ~ ": Δ Height"~ "(" ~ cm^{2} ~ m^{-2} ~ ")"))

fig7c <- ggplot(fig7_df, aes(x = Needle, y = Compensation_Start, col = Species)) + 
  geom_point(size = 5) + 
  scale_color_discrete(type = c(lob2fill, lob1fill, longfill, shortleaffill, slashfill, virginiafill)) + 
  theme_few() + theme(legend.position = 'none') + 
  annotate('text', x = 33, y = 0.12, label = bquote(R^{2} ~ "= 0.85"), cex = 6) + 
  geom_line(data = fig7_line, aes(x = X, y = Line_Start))  + 
  annotate('text', x = 28, y = -0.05, label = "p = 0.005", cex = 4) + 
  labs(x = "Needle Length (cm)", y = bquote("Δ Starting" ~ A[S] ~ "/" ~ A[L] ~ ": Δ Height"~ "(" ~ cm^{2} ~ m^{-2} ~ ")"))
```

###Figures

Environmental variables for the study.
```{r fig 1a}
#Un-comment the next two lines for the first run, then hide for subsequent runs of the code.
#df_env[115,] <- NA
#df_env[115,] <- df_env[57,]

df <- df_env
df$Year <- as.factor(df$y)
year <- "Duke Forest, 2018-2022"
axislabel <- bquote(D[Z] ~ "(kPa)")

dt1 <- group_by(df[df$Condition == "Wet",], Year) %>%
  summarise(dz=mean(d, na.rm = T), rew=mean(r, na.rm = T))

dt2 <- group_by(df[df$Condition == "Dry",], Year) %>%
  summarise(dz=mean(d, na.rm = T), rew=mean(r, na.rm = T))

n1 <- length(df$Day[df$y == 2018 & df$Condition == "Wet"]) #15
n2 <- length(df$Day[df$y == 2019 & df$Condition == "Wet"]) #14
n3 <- length(df$Day[df$y == 2020 & df$Condition == "Wet"]) #18
n4 <- length(df$Day[df$y == 2021 & df$Condition == "Wet"]) #14
n5 <- length(df$Day[df$y == 2022 & df$Condition == "Wet"]) #16

n.1 <- length(df$Day[df$y == 2018 & df$Condition == "Dry"]) #15
n.2 <- length(df$Day[df$y == 2019 & df$Condition == "Dry"]) #14
n.3 <- length(df$Day[df$y == 2020 & df$Condition == "Dry"]) #18
n.4 <- length(df$Day[df$y == 2021 & df$Condition == "Dry"]) #14
n.5 <- length(df$Day[df$y == 2022 & df$Condition == "Dry"]) #16

d.t <- data.frame(Year = dt1$Year,
                 Dz.Wet = dt1$dz, Dz.Dry = dt2$dz,
                 REW.Wet = dt1$rew, REW.Dry = dt2$rew,
                 Wet.N = c(n1, n2, n3, n4, n5), 
                 Dry.N = c(1, n.2, n.3, n.4, n.5))

anova <- aov(d ~ as.factor(y), data = df[df$Condition == "Wet",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$`as.factor(y)`)
d.t$cld1 <- cld$Letters[c(2, 1, 3, 5, 4)]

anova <- aov(d ~ as.factor(y), data = df[df$Condition == "Dry",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$`as.factor(y)`)
d.t$cld2 <- cld$Letters[c(1, 2, 3, 5, 4)]
#No difference in Dz under wet or dry conditions

df_env$Year <- as.factor(df_env$y)
pdatdz <- df_env %>%
  group_by(Condition, Year) %>%
  do(data.frame(loc = density(.$d, na.rm = T)$x,
                dens = density(.$d, na.rm = T)$y))

pdatdz$dens[pdatdz$Condition == "Wet"] <- 
  pdatdz$dens[pdatdz$Condition == "Wet"]*-1

pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Dry"] <- NA

pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Dry"]))+4

pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Dry"]))+7

pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Dry"]))+10

pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Dry"]))+13

pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Wet"]))+1

pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Wet"]))+4

pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Wet"]))+7

pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Wet"]))+10

pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Wet"]))+13

yrlabels <- c("2018", "2019", "2020", "2021", "2022")

minipoint <- data.frame(X = 1.4, Y = 0.9049100, Year = 2018, Condition = "Dry")

fig1a <- ggplot(data = pdatdz, aes(dens, loc, fill = as.factor(Year), alpha = Condition)) + geom_polygon() + labs(x = "Year" , y = bquote(D[Z] ~ " " ~ "[kPa]")) + scale_x_continuous(breaks=seq(1,13,3), labels = yrlabels) + theme_few()+geom_point(data = minipoint, aes(x=X,y=Y), size = 7, col = shortleaffill)  + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26),  
axis.title.x =  element_blank(), 
axis.title.y = element_text(size = 30, colour = 'black'),
axis.text.y.left = element_text(size = 28, colour = 'black'),
legend.text = element_text(size = 26), 
legend.title = element_blank(), 
axis.text.x = element_text(size = 22, colour = 'white'),  
legend.position = c(0.75, 0.9)) + guides(fill = 'none', alpha=guide_legend(title="Soil Moisture"), col = 'none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Soil", "Dry Soil")) + ggtitle("Duke Forest, 2018-2022")   +  scale_fill_manual(values = c("2018" = shortleaffill, "2019" = shortleaffill, "2020" = shortleaffill, "2021" = shortleaffill, "2022" = shortleaffill)) + 
  annotate("text", x = seq(1,13,3)-.4, y = (d.t$Dz.Wet)*1.5, cex= 8, label = d.t$cld1, col = shortleaffill) + 
  annotate("text", x = seq(1,13,3)+.4, y = (d.t$Dz.Dry)*1.5, cex= 8, label = d.t$cld2, col = shortleaffill, alpha = 0.5) + 
 annotate("text", x = seq(1,13,3)-.5, y = (d.t$Dz.Wet), cex= 5, label = d.t$Wet.N, col = "black") +
  annotate("text", x = seq(1,13,3)+.4, y = (d.t$Dz.Dry), cex= 5, label = d.t$Dry.N, col = "black") + scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0.5,1.75)) + annotate('text', x = 0.15, y = 1.75, label = "A", cex = 8, fontface = 'bold')
```

```{r save 1a}
ggsave(filename = "figure_1a.png", 
       plot = fig1a,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

```{r fig 1b}
boxplot(dd_env$r~dd_env$y)
boxplot(df_env$r~df_env$y)

df <- df_env
df$Year <- as.factor(df$y)
year <- "Duke Forest, 2018-2022"
axislabel <- bquote(D[Z] ~ "(kPa)")

dt1 <- group_by(df[df$Condition == "Wet",], Year) %>%
  summarise(dz=mean(d, na.rm = T), rew=mean(r, na.rm = T))

dt2 <- group_by(df[df$Condition == "Dry",], Year) %>%
  summarise(dz=mean(d, na.rm = T), rew=mean(r, na.rm = T))

n1 <- length(df$Day[df$y == 2018 & df$Condition == "Wet"]) #15
n2 <- length(df$Day[df$y == 2019 & df$Condition == "Wet"]) #14
n3 <- length(df$Day[df$y == 2020 & df$Condition == "Wet"]) #18
n4 <- length(df$Day[df$y == 2021 & df$Condition == "Wet"]) #14
n5 <- length(df$Day[df$y == 2022 & df$Condition == "Wet"]) #16

n.1 <- length(df$Day[df$y == 2018 & df$Condition == "Dry"]) #15
n.2 <- length(df$Day[df$y == 2019 & df$Condition == "Dry"]) #14
n.3 <- length(df$Day[df$y == 2020 & df$Condition == "Dry"]) #18
n.4 <- length(df$Day[df$y == 2021 & df$Condition == "Dry"]) #14
n.5 <- length(df$Day[df$y == 2022 & df$Condition == "Dry"]) #16

d.t <- data.frame(Year = dt1$Year,
                 Dz.Wet = dt1$dz, Dz.Dry = dt2$dz,
                 REW.Wet = dt1$rew, REW.Dry = dt2$rew,
                 Wet.N = c(n1, n2, n3, n4, n5), 
                 Dry.N = c(1, n.2, n.3, n.4, n.5))

anova <- aov(r ~ as.factor(y), data = df[df$Condition == "Wet",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$`as.factor(y)`)
d.t$cld1 <- cld$Letters[c(2, 1, 3, 5, 4)]

anova <- aov(r ~ as.factor(y), data = df[df$Condition == "Dry",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$`as.factor(y)`)
d.t$cld2 <- cld$Letters[c(1, 2, 3, 5, 4)]
#introduced variability to rew in wet, but not dry conditions.

df_env$Year <- as.factor(df_env$y)
pdatdz <- df_env %>%
  group_by(Condition, Year) %>%
  do(data.frame(loc = density(.$r, na.rm = T)$x,
                dens = density(.$r, na.rm = T)$y))

pdatdz$dens[pdatdz$Condition == "Wet"] <- 
  pdatdz$dens[pdatdz$Condition == "Wet"]*-1

pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Dry"] <- NA

pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Dry"]))+4

pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Dry"]))+7

pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Dry"]))+10

pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Dry"] <- 
  (pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Dry"]/
  max(pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Dry"]))+13

pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2018" & pdatdz$Condition == "Wet"]))+1

pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2019" & pdatdz$Condition == "Wet"]))+4

pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2020" & pdatdz$Condition == "Wet"]))+7

pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2021" & pdatdz$Condition == "Wet"]))+10

pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Wet"] <- 
  (-pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Wet"]/
  min(pdatdz$dens[pdatdz$Year == "2022" & pdatdz$Condition == "Wet"]))+13

yrlabels <- c("2018", "2019", "2020", "2021", "2022")

minipoint2 <- data.frame(X = 1.7, Y = 0.1781736, Year = 2018, Condition = "Dry")

fig1b <- ggplot(data = pdatdz, aes(dens, loc, fill = as.factor(Year), alpha = Condition)) + geom_polygon() + labs(x = "Year" , y = "REW") + scale_x_continuous(breaks=seq(1,13,3), labels = yrlabels) + theme_few() + geom_point(data = minipoint2, aes(x=X,y=Y), size = 8, col = virginiafill) + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 30),  
axis.title.x =  element_blank(), 
axis.title.y = element_text(size = 30, colour = 'black'),
axis.text.y.left = element_text(size = 28, colour = 'black'),
legend.text = element_text(size = 30), 
legend.title = element_blank(), 
axis.text.x = element_text(size = 22), 
legend.position = c(0.85, 0.9)) + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("All Soil Conditions", "Dry Soil"), labels = c("Moist Soil", "Dry Soil")) + ggtitle("  ")   + guides(fill = 'none', alpha=guide_legend(title="Soil Moisture")) +  scale_fill_manual(values = c("2018" = virginiafill, "2019" = virginiafill, "2020" = virginiafill, "2021" = virginiafill, "2022" = virginiafill)) +  
  annotate("text", x = seq(1,13,3)-.7, y = (d.t$REW.Wet)*1.75, cex= 8, label = d.t$cld1, col = virginiafill) + 
  annotate("text", x = seq(1,13,3)+.7, y = (d.t$REW.Dry)*2.5, cex= 8, label = d.t$cld2, col = virginiafill, alpha = 0.5) + lims(y = c(-0.05, 0.7)) + annotate('text', x = 0.15, y = 0.68, label = "B", cex = 8, fontface = 'bold')
```

```{r save 1b}
ggsave(filename = "figure_1b.png", 
       plot = fig1b,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

Determine if wet conditions generate a greater value of Js or El than dry conditions. This will be the (*) in Figure 2.
```{r wet vs dry}
t.test(df_virg$j[df_virg$y == 2018 & df_virg$Condition == "Wet"], 
       mu = df_virg$j[df_virg$y == 2018 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$j[df_short$y == 2018 & df_short$Condition == "Wet"], 
       mu = df_short$j[df_short$y == 2018 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$j[df_lob2$y == 2018 & df_lob2$Condition == "Wet"], 
       mu = df_lob2$j[df_lob2$y == 2018 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$j[df_lob1$y == 2018 & df_lob1$Condition == "Wet"], 
       mu = df_lob1$j[df_lob1$y == 2018 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$j[df_slash$y == 2018 & df_slash$Condition == "Wet"], 
       mu = df_slash$j[df_slash$y == 2018 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$j[df_long$y == 2018 & df_long$Condition == "Wet"], 
       mu = df_long$j[df_long$y == 2018 & df_long$Condition == "Dry"], alternative = "greater") #*
      

t.test(df_virg$e[df_virg$y == 2018 & df_virg$Condition == "Wet"], 
       mu = df_virg$e[df_virg$y == 2018 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$e[df_short$y == 2018 & df_short$Condition == "Wet"], 
       mu = df_short$e[df_short$y == 2018 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$e[df_lob2$y == 2018 & df_lob2$Condition == "Wet"], 
       mu = df_lob2$e[df_lob2$y == 2018 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$e[df_lob1$y == 2018 & df_lob1$Condition == "Wet"], 
       mu = df_lob1$e[df_lob1$y == 2018 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$e[df_slash$y == 2018 & df_slash$Condition == "Wet"], 
       mu = df_slash$e[df_slash$y == 2018 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$e[df_long$y == 2018 & df_long$Condition == "Wet"], 
       mu = df_long$e[df_long$y == 2018 & df_long$Condition == "Dry"], alternative = "greater") #*
       
dt_1$Star <- NA
dt_1$Star <- c("*", NA, NA, NA, NA, "*")

t.test(df_virg$j[df_virg$y == 2019 & df_virg$Condition == "Wet"], 
       df_virg$j[df_virg$y == 2019 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$j[df_short$y == 2019 & df_short$Condition == "Wet"], 
       df_short$j[df_short$y == 2019 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$j[df_lob2$y == 2019 & df_lob2$Condition == "Wet"], 
       df_lob2$j[df_lob2$y == 2019 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$j[df_lob1$y == 2019 & df_lob1$Condition == "Wet"], 
       df_lob1$j[df_lob1$y == 2019 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$j[df_slash$y == 2019 & df_slash$Condition == "Wet"], 
       df_slash$j[df_slash$y == 2019 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$j[df_long$y == 2019 & df_long$Condition == "Wet"], 
       df_long$j[df_long$y == 2019 & df_long$Condition == "Dry"], alternative = "greater") #*
       
dt.2$Star <- NA
dt.2$Star <- c("*", "*", "*", "*", "*", "*")
       
t.test(df_virg$e[df_virg$y == 2019 & df_virg$Condition == "Wet"], 
       df_virg$e[df_virg$y == 2019 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$e[df_short$y == 2019 & df_short$Condition == "Wet"], 
       df_short$e[df_short$y == 2019 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$e[df_lob2$y == 2019 & df_lob2$Condition == "Wet"], 
       df_lob2$e[df_lob2$y == 2019 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$e[df_lob1$y == 2019 & df_lob1$Condition == "Wet"], 
       df_lob1$e[df_lob1$y == 2019 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$e[df_slash$y == 2019 & df_slash$Condition == "Wet"], 
       df_slash$e[df_slash$y == 2019 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$e[df_long$y == 2019 & df_long$Condition == "Wet"], 
       df_long$e[df_long$y == 2019 & df_long$Condition == "Dry"], alternative = "greater") #*
       
dt_2$Star <- NA
dt_2$Star <- c("*", "*", "*", "*", "*", "*")
       
t.test(df_virg$j[df_virg$y == 2020 & df_virg$Condition == "Wet"], 
       df_virg$j[df_virg$y == 2020 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$j[df_short$y == 2020 & df_short$Condition == "Wet"], 
       df_short$j[df_short$y == 2020 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$j[df_lob2$y == 2020 & df_lob2$Condition == "Wet"], 
       df_lob2$j[df_lob2$y == 2020 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$j[df_lob1$y == 2020 & df_lob1$Condition == "Wet"], 
       df_lob1$j[df_lob1$y == 2020 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$j[df_slash$y == 2020 & df_slash$Condition == "Wet"], 
       df_slash$j[df_slash$y == 2020 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$j[df_long$y == 2020 & df_long$Condition == "Wet"], 
       df_long$j[df_long$y == 2020 & df_long$Condition == "Dry"], alternative = "greater") #*
       
dt.3$Star <- NA
dt.3$Star <- c("*", "*", "*", "*", "*", ".")
       
t.test(df_virg$e[df_virg$y == 2020 & df_virg$Condition == "Wet"], 
       df_virg$e[df_virg$y == 2020 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$e[df_short$y == 2020 & df_short$Condition == "Wet"], 
       df_short$e[df_short$y == 2020 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$e[df_lob2$y == 2020 & df_lob2$Condition == "Wet"], 
       df_lob2$e[df_lob2$y == 2020 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$e[df_lob1$y == 2020 & df_lob1$Condition == "Wet"], 
       df_lob1$e[df_lob1$y == 2020 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$e[df_slash$y == 2020 & df_slash$Condition == "Wet"], 
       df_slash$e[df_slash$y == 2020 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$e[df_long$y == 2020 & df_long$Condition == "Wet"], 
       df_long$e[df_long$y == 2020 & df_long$Condition == "Dry"], alternative = "greater") #*
       
dt_3$Star <- NA
dt_3$Star <- c("*", "*", "*", "*", "*", "*")
       
t.test(df_virg$j[df_virg$y == 2021 & df_virg$Condition == "Wet"], 
       df_virg$j[df_virg$y == 2021 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$j[df_short$y == 2021 & df_short$Condition == "Wet"], 
       df_short$j[df_short$y == 2021 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$j[df_lob2$y == 2021 & df_lob2$Condition == "Wet"], 
       df_lob2$j[df_lob2$y == 2021 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$j[df_lob1$y == 2021 & df_lob1$Condition == "Wet"], 
       df_lob1$j[df_lob1$y == 2021 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$j[df_slash$y == 2021 & df_slash$Condition == "Wet"], 
       df_slash$j[df_slash$y == 2021 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$j[df_long$y == 2021 & df_long$Condition == "Wet"], 
       df_long$j[df_long$y == 2021 & df_long$Condition == "Dry"], alternative = "greater") #*
       
dt.4$Star <- NA
dt.4$Star <- c("*", "*", "*", NA, "*", "*")
       
t.test(df_virg$e[df_virg$y == 2021 & df_virg$Condition == "Wet"], 
       df_virg$e[df_virg$y == 2021 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$e[df_short$y == 2021 & df_short$Condition == "Wet"], 
       df_short$e[df_short$y == 2021 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$e[df_lob2$y == 2021 & df_lob2$Condition == "Wet"], 
       df_lob2$e[df_lob2$y == 2021 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$e[df_lob1$y == 2021 & df_lob1$Condition == "Wet"], 
       df_lob1$e[df_lob1$y == 2021 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$e[df_slash$y == 2021 & df_slash$Condition == "Wet"], 
       df_slash$e[df_slash$y == 2021 & df_slash$Condition == "Dry"], alternative = "greater") #*
t.test(df_long$e[df_long$y == 2021 & df_long$Condition == "Wet"], 
       df_long$e[df_long$y == 2021 & df_long$Condition == "Dry"], alternative = "greater") #*
       
dt_4$Star <- NA
dt_4$Star <- c("*", "*", "*", NA, "*", "*")
       
t.test(df_virg$j[df_virg$y == 2022 & df_virg$Condition == "Wet"], 
       df_virg$j[df_virg$y == 2022 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$j[df_short$y == 2022 & df_short$Condition == "Wet"], 
       df_short$j[df_short$y == 2022 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$j[df_lob2$y == 2022 & df_lob2$Condition == "Wet"], 
       df_lob2$j[df_lob2$y == 2022 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$j[df_lob1$y == 2022 & df_lob1$Condition == "Wet"], 
       df_lob1$j[df_lob1$y == 2022 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$j[df_slash$y == 2022 & df_slash$Condition == "Wet"], 
       df_slash$j[df_slash$y == 2022 & df_slash$Condition == "Dry"], alternative = "greater") #*
       
dt.5$Star <- NA
dt.5$Star <- c("*", "*", "*", "*", "*", NA)
       
t.test(df_virg$e[df_virg$y == 2022 & df_virg$Condition == "Wet"], 
       df_virg$e[df_virg$y == 2022 & df_virg$Condition == "Dry"], alternative = "greater") #*
t.test(df_short$e[df_short$y == 2022 & df_short$Condition == "Wet"], 
       df_short$e[df_short$y == 2022 & df_short$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob2$e[df_lob2$y == 2022 & df_lob2$Condition == "Wet"], 
       df_lob2$e[df_lob2$y == 2022 & df_lob2$Condition == "Dry"], alternative = "greater") #*
t.test(df_lob1$e[df_lob1$y == 2022 & df_lob1$Condition == "Wet"], 
       df_lob1$e[df_lob1$y == 2022 & df_lob1$Condition == "Dry"], alternative = "greater") #*
t.test(df_slash$e[df_slash$y == 2022 & df_slash$Condition == "Wet"], 
       df_slash$e[df_slash$y == 2022 & df_slash$Condition == "Dry"], alternative = "greater") #*
       
dt_5$Star <- NA
dt_5$Star <- c("*", NA, NA, "*", "*", NA)
```

Sap flux and transpiration per unit leaf area distributions over the course of the study.
```{r fig 2a-f}
#Un-comment the next two lines for the first run, then hide for subsequent runs of the code.
#df_all[471:476,] <- df_all[df_all$y == 2018 & df_all$Condition == "Dry",]
#df_all$e[df_all$y == 2022 & df_all$e > 1.5] <- NA

yr <- 2018
df <- df_all[df_all$y == yr,]
df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(j ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(j, na.rm = T)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(j, na.rm = T)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(j ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(j ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters

dt.1 <- dt

dt.1$Star <- NA
dt.1$Star <- c("*", NA, NA, "*", NA, NA)

pdat18 <- df_all[df_all$y == 2018,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$j, na.rm = T)$x,
                dens = density(.$j, na.rm = T)$y))

pdat18$dens[pdat18$Condition == "Wet"] <- pdat18$dens[pdat18$Condition == "Wet"]*-1

pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Wet"] <- 
  (-pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Wet"]/
  min(pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Wet"])+1)

pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Wet"] <- 
  ((-pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Wet"]))+4)

pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Wet"] <- 
 ((-pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Wet"]))+7)

pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Wet"] <- 
  ((-pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Wet"]))+10)

pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Wet"] <- 
  ((-pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Wet"]/
  min(pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Wet"]))+13)

pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Wet"] <- 
 ((-pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Wet"]))+16)

speclabels <-  c("PV", "PEC", "PT2", "PT1", "PEL", 'PP')

minipoints <- data.frame(X = c(1.5,  4.5,  7.5, 10.5, 13.5, 16.5), Y = dt.1$Dry, s = c("Virginia", "Shortleaf", "Loblolly2", "Loblolly1", "Slash", "Longleaf"), Condition = "Dry")

js18 <- ggplot(data = pdat18, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(J[S[Max]] ~ "(" ~ m^{3} ~ " " ~ m^{-2} ~ " " ~ d^{-1} ~ ")")) + geom_point(data = minipoints, aes(x = X, y = Y), col = "#1874cd", size = 5) +
  scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24, color = 'white'), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 5, label = "2018", size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,5)) + annotate("text", x = seq(1,16,3), y = (dt.1$Wet)+1, cex = 9, label = dt.1$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 5, label = "A", cex = 8, fontface = 'bold')

## 2019
yr <- 2019
df <- df_all[df_all$y == yr,]

boxplot(j~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(j ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(j)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(j)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(j ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(j ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters

dt.2 <- dt

dt.2$Star <- NA
dt.2$Star <- c("*", "*", "*", "*", "*", "*")

pdat19 <- df_all[df_all$y == yr,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$j, na.rm = T)$x,
                dens = density(.$j, na.rm = T)$y))

pdat19$dens[pdat19$Condition == "Wet"] <- pdat19$dens[pdat19$Condition == "Wet"]*-1

pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Dry"]/
  max(pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Dry"]))+1

pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Dry"]))+4

pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Dry"]))+7

pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Dry"]))+10

pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Dry"]/
  max(pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Dry"]))+13

pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Dry"]))+16

pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Wet"] <- 
  (-pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Wet"]/
  min(pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Wet"])+1)

pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Wet"] <- 
  ((-pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Wet"]))+4)

pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Wet"] <- 
 ((-pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Wet"]))+7)

pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Wet"] <- 
  ((-pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Wet"]))+10)

pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Wet"] <- 
  ((-pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Wet"]/
  min(pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Wet"]))+13)

pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Wet"] <- 
 ((-pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Wet"]))+16)

speclabels <-  c("PV", "PEC", "PT2", "PT1", "PEL", 'PP')

js19 <- ggplot(data = pdat19, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(J[S[Max]] ~ "(" ~ m^{3} ~ " " ~ m^{-2} ~ " " ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24, color = 'white'), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 5, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,5))  + annotate("text", x = seq(1,16,3), y = (dt.2$Wet)+1, cex = 9, label = dt.2$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 5, label = "B", cex = 8, fontface = 'bold')

## 2020
yr <- 2020
df <- df_all[df_all$y == yr,]

boxplot(j~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(j ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(j)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(j)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(j ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(j ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters

dt.3 <- dt

dt.3$Star <- NA
dt.3$Star <- c("*", "*", "*", "*", "*", ".")

pdat20 <- df_all[df_all$y == yr,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$j, na.rm = T)$x,
                dens = density(.$j, na.rm = T)$y))

pdat20$dens[pdat20$Condition == "Wet"] <- pdat20$dens[pdat20$Condition == "Wet"]*-1

pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Dry"]/
  max(pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Dry"]))+1

pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Dry"]))+4

pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Dry"]))+7

pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Dry"]))+10

pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Dry"]/
  max(pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Dry"]))+13

pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Dry"]))+16

pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Wet"] <- 
  (-pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Wet"]/
  min(pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Wet"])+1)

pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Wet"] <- 
  ((-pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Wet"]))+4)

pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Wet"] <- 
 ((-pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Wet"]))+7)

pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Wet"] <- 
  ((-pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Wet"]))+10)

pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Wet"] <- 
  ((-pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Wet"]/
  min(pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Wet"]))+13)

pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Wet"] <- 
 ((-pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Wet"]))+16)

yr <- 2020
js20 <- ggplot(data = pdat20, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(J[S] ~ "(" ~ m^{3} ~ " " ~ m^{-2} ~ " " ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 5, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(-0.3,5)) + annotate("text", x = seq(1,16,3), y = (dt.3$Wet)+1, cex = 9, label = dt.3$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 5, label = "C", cex = 8, fontface = 'bold')

## 2021
yr <- 2021
df <- df_all[df_all$y == yr,]

boxplot(j~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(j ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(j)) %>%
  arrange(desc(s))
dt1[6,] <- NA
dt1$s[6] <- "Loblolly1"

dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(j)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(j ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld[6,] <- NA
cld$s[6] <- "Loblolly1"
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(j ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters

dt.4 <- dt

dt.4$Star <- NA
dt.4$Star <- c("*", "*", "*", NA, "*", "*")

pdat21 <- df_all[df_all$y == yr,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$j, na.rm = T)$x,
                dens = density(.$j, na.rm = T)$y))

pdat21$dens[pdat21$Condition == "Wet"] <- pdat21$dens[pdat21$Condition == "Wet"]*-1

pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Dry"]/
  max(pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Dry"]))+1

pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Dry"]))+4

pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Dry"]))+7

pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Dry"]))+10

pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Dry"]/
  max(pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Dry"]))+13

pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Dry"]))+16

pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Wet"] <- 
  (-pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Wet"]/
  min(pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Wet"])+1)

pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Wet"] <- 
  ((-pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Wet"]))+4)

pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Wet"] <- 
 ((-pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Wet"]))+7)

pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Wet"] <- 
  ((-pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Wet"]))+10)

pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Wet"] <- 
  ((-pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Wet"]/
  min(pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Wet"]))+13)

pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Wet"] <- 
 ((-pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Wet"]))+16)


js21 <- ggplot(data = pdat21, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(J[S[Max]] ~ "(" ~ m^{3} ~ " " ~ m^{-2} ~ " " ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=21,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24, color = 'white'), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 5, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,5))  + annotate("text", x = seq(1,16,3), y = (dt.4$Wet)+1, cex = 9, label = dt.4$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 5, label = "D", cex = 8, fontface = 'bold')

## 2022
yr <- 2022
df <- df_all[df_all$y == yr,]

boxplot(j~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(j ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(j)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(j)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(j ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(j ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters
dt.5 <- dt

dt.5[6,] <- c("Longleaf", NA, NA, NA, NA)
dt.5$Wet <- as.numeric(dt.5$Wet)
dt.5$Dry <- as.numeric(dt.5$Dry)

dt.5$Star <- NA
dt.5$Star <- c("*", "*", "*", "*", "*", NA)

pdat22 <- df_all[df_all$y == yr,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$j, na.rm = T)$x,
                dens = density(.$j, na.rm = T)$y))

pdat22$dens[pdat22$Condition == "Wet"] <- pdat22$dens[pdat22$Condition == "Wet"]*-1

pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Dry"]/
  max(pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Dry"]))+1

pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Dry"]))+4

pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Dry"]))+7

pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Dry"]))+10

pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Dry"]/
  max(pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Dry"]))+13

pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Dry"]))+16

pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Wet"] <- 
  (-pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Wet"]/
  min(pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Wet"])+1)

pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Wet"] <- 
  ((-pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Wet"]))+4)

pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Wet"] <- 
 ((-pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Wet"]))+7)

pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Wet"] <- 
  ((-pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Wet"]))+10)

pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Wet"] <- 
  ((-pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Wet"]/
  min(pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Wet"]))+13)

pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Wet"] <- 
 ((-pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Wet"]))+16)


js22 <- ggplot(data = pdat22, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(J[S[Max]] ~ "(" ~ m^{3} ~ " " ~ m^{-2} ~ " " ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=22,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24, color = 'white'), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 5, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,5))  + annotate("text", x = seq(1,16,3), y = (dt.5$Wet)+1, cex = 9, label = dt.5$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 5, label = "E", cex = 8, fontface = 'bold')


##Now, El
df <- df_all[df_all$y == 2018,]

boxplot(e~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(e ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(e)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(e)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(e ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(e ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters

dt_1 <- dt

dt_1$Star <- NA
dt_1$Star <- c("*", NA, NA, NA, NA, "*")

pdat18 <- df_all[df_all$y == 2018,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$e, na.rm = T)$x,
                dens = density(.$e, na.rm = T)$y))

pdat18$dens[pdat18$Condition == "Wet"] <- pdat18$dens[pdat18$Condition == "Wet"]*-1

pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Dry"] <- NA

pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Wet"] <- 
  (-pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Wet"]/
  min(pdat18$dens[pdat18$s == "Virginia" & pdat18$Condition == "Wet"])+1)

pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Wet"] <- 
  ((-pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Shortleaf" & pdat18$Condition == "Wet"]))+4)

pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Wet"] <- 
 ((-pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Loblolly2" & pdat18$Condition == "Wet"]))+7)

pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Wet"] <- 
  ((-pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Loblolly1" & pdat18$Condition == "Wet"]))+10)

pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Wet"] <- 
  ((-pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Wet"]/
  min(pdat18$dens[pdat18$s == "Slash" & pdat18$Condition == "Wet"]))+13)

pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Wet"] <- 
 ((-pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Wet"]/
     min(pdat18$dens[pdat18$s == "Longleaf" & pdat18$Condition == "Wet"]))+16)

minipoints2 <- data.frame(X = c(1.5,  4.5,  7.5, 10.5, 13.5, 16.5), Y = dt_1$Dry, s = c("Virginia", "Shortleaf", "Loblolly2", "Loblolly1", "Slash", "Longleaf"), Condition = "Dry")


el18 <- ggplot(data = pdat18, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(E[L[Max]] ~ "( mm" ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() + geom_point(data = minipoints2, aes(x = X, y = Y), col = "#1874cd", size = 5) +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)),                                                                                                    axis.text.y.right = element_text(size = 22, colour = 'black'), axis.title.y.right = element_text(size = 24, color = 'white'),
axis.text.y = element_blank(), axis.title.y = element_blank(),                                                                                                      legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("Duke Forest, 2018-2022") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 3, label = "2018", size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,3), position = 'right')  + annotate("text", x = seq(1,16,3), y = (dt_1$Wet)+1, cex = 9, label = dt_1$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 3, label = "F", cex = 8, fontface = 'bold')

## 2019
yr <- 2019
df <- df_all[df_all$y == yr,]

boxplot(e~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(e ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(e)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(e)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(e ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(e ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters

dt_2 <- dt

dt_2$Star <- NA
dt_2$Star <- c("*", "*", "*", "*", "*", "*")

pdat19 <- df_all[df_all$y == yr,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$e, na.rm = T)$x,
                dens = density(.$e, na.rm = T)$y))

pdat19$dens[pdat19$Condition == "Wet"] <- pdat19$dens[pdat19$Condition == "Wet"]*-1

pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Dry"]/
  max(pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Dry"]))+1

pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Dry"]))+4

pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Dry"]))+7

pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Dry"]))+10

pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Dry"]/
  max(pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Dry"]))+13

pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Dry"] <- 
  (pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Dry"]/
     max(pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Dry"]))+16

pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Wet"] <- 
  (-pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Wet"]/
  min(pdat19$dens[pdat19$s == "Virginia" & pdat19$Condition == "Wet"])+1)

pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Wet"] <- 
  ((-pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Shortleaf" & pdat19$Condition == "Wet"]))+4)

pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Wet"] <- 
 ((-pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Loblolly2" & pdat19$Condition == "Wet"]))+7)

pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Wet"] <- 
  ((-pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Loblolly1" & pdat19$Condition == "Wet"]))+10)

pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Wet"] <- 
  ((-pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Wet"]/
  min(pdat19$dens[pdat19$s == "Slash" & pdat19$Condition == "Wet"]))+13)

pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Wet"] <- 
 ((-pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Wet"]/
     min(pdat19$dens[pdat19$s == "Longleaf" & pdat19$Condition == "Wet"]))+16)

el19 <- ggplot(data = pdat19, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(E[L[Max]] ~ "( mm" ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y.right = element_text(size = 22, colour = 'black'), axis.title.y.right = element_text(size = 24, color = 'white'), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 3, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,3), position = 'right')  + annotate("text", x = seq(1,16,3), y = (dt_2$Wet)+1, cex = 9, label = dt_2$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 3, label = "G", cex = 8, fontface = 'bold')

## 2020
yr <- 2020
df <- df_all[df_all$y == yr,]

boxplot(e~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(e ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(e)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(e)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(e ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(e ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters

dt_3 <- dt

dt_3$Star <- NA
dt_3$Star <- c("*", "*", "*", "*", "*", "*")

pdat20 <- df_all[df_all$y == yr,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$e, na.rm = T)$x,
                dens = density(.$e, na.rm = T)$y))

pdat20$dens[pdat20$Condition == "Wet"] <- pdat20$dens[pdat20$Condition == "Wet"]*-1

pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Dry"]/
  max(pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Dry"]))+1

pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Dry"]))+4

pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Dry"]))+7

pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Dry"]))+10

pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Dry"]/
  max(pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Dry"]))+13

pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Dry"] <- 
  (pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Dry"]/
     max(pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Dry"]))+16

pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Wet"] <- 
  (-pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Wet"]/
  min(pdat20$dens[pdat20$s == "Virginia" & pdat20$Condition == "Wet"])+1)

pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Wet"] <- 
  ((-pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Shortleaf" & pdat20$Condition == "Wet"]))+4)

pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Wet"] <- 
 ((-pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Loblolly2" & pdat20$Condition == "Wet"]))+7)

pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Wet"] <- 
  ((-pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Loblolly1" & pdat20$Condition == "Wet"]))+10)

pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Wet"] <- 
  ((-pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Wet"]/
  min(pdat20$dens[pdat20$s == "Slash" & pdat20$Condition == "Wet"]))+13)

pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Wet"] <- 
 ((-pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Wet"]/
     min(pdat20$dens[pdat20$s == "Longleaf" & pdat20$Condition == "Wet"]))+16)

yr <- 2020
el20 <- ggplot(data = pdat20, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(E[L] ~ "( mm" ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 3, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(-0.3,3), position = 'right')  + annotate("text", x = seq(1,16,3), y = (dt_3$Wet)+1, cex = 9, label = dt_3$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 3, label = "H", cex = 8, fontface = 'bold')

## 2021
yr <- 2021
df <- df_all[df_all$y == yr,]

boxplot(e~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(e ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(e)) %>%
  arrange(desc(s))
dt1[6,] <- NA
dt1$s[6] <- "Loblolly1"

dt1$Num <- c(6, 2, 5, 1, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(e)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 1, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(e ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld[6,] <- NA
cld$s[6] <- "Loblolly1"
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(e ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 1, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- cld$Letters
dt_4 <- dt

dt_4$Star <- NA
dt_4$Star <- c("*", "*", "*", NA, "*", "*")

pdat21 <- df_all[df_all$y == yr,] %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$e, na.rm = T)$x,
                dens = density(.$e, na.rm = T)$y))

pdat21$dens[pdat21$Condition == "Wet"] <- pdat21$dens[pdat21$Condition == "Wet"]*-1

pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Dry"]/
  max(pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Dry"]))+1

pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Dry"]))+4

pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Dry"]))+7

pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Dry"]))+10

pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Dry"]/
  max(pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Dry"]))+13

pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Dry"] <- 
  (pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Dry"]/
     max(pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Dry"]))+16

pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Wet"] <- 
  (-pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Wet"]/
  min(pdat21$dens[pdat21$s == "Virginia" & pdat21$Condition == "Wet"])+1)

pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Wet"] <- 
  ((-pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Shortleaf" & pdat21$Condition == "Wet"]))+4)

pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Wet"] <- 
 ((-pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Loblolly2" & pdat21$Condition == "Wet"]))+7)

pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Wet"] <- 
  ((-pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Loblolly1" & pdat21$Condition == "Wet"]))+10)

pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Wet"] <- 
  ((-pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Wet"]/
  min(pdat21$dens[pdat21$s == "Slash" & pdat21$Condition == "Wet"]))+13)

pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Wet"] <- 
 ((-pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Wet"]/
     min(pdat21$dens[pdat21$s == "Longleaf" & pdat21$Condition == "Wet"]))+16)

el21 <- ggplot(data = pdat21, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(E[L[Max]] ~ "( mm" ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=21,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24, color = 'white'), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 3, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,3), position = 'right')  + annotate("text", x = seq(1,16,3), y = (dt_4$Wet)+1, cex = 9, label = dt_4$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 3, label = "I", cex = 8, fontface = 'bold')

## 2022
yr <- 2022
df <- df_all[df_all$y == yr & df_all$e < 1.65,]

boxplot(e~s+Condition, df)

df$Condition[df$Condition == "Wet"] <- "A"
df$Condition[df$Condition == "Dry"] <- "B"
anova <- aov(e ~ Condition, data = df)
summary(anova)

dt1 <- group_by(df[df$Condition == "A",], s) %>%
  summarise(w=max(e)) %>%
  arrange(desc(s))
dt1$Num <- c(6, 2, 5, 4, 3)
dt1 <- dt1 %>% arrange(desc(Num))

dt2 <- group_by(df[df$Condition == "B",], s) %>%
  summarise(d=max(e)) %>%
  arrange(desc(s))
dt2$Num <- c(6, 2, 5, 4, 3)
dt2 <- dt2 %>% arrange(desc(Num))

dt <- data.frame(s = dt1$s, Wet = dt1$w, Dry = dt2$d)

anova <- aov(e ~ s, data = df[df$Condition == "A",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld1 <- cld$Letters

anova <- aov(e ~ s, data = df[df$Condition == "B",])
tukey <- TukeyHSD(anova)
cld <- multcompLetters4(anova, tukey)
cld <- as.data.frame.list(cld$s)
cld <- cbind(s = rownames(cld), cld)
cld <- cld %>% arrange(desc(s))
cld$Num <- c(6, 2, 5, 4, 3)
cld <- cld %>% arrange(desc(Num))
print(cld)
dt$cld2 <- c(cld$Letters, NA)
dt_5 <- dt

#dt_5[6,] <- c("Longleaf", NA, NA, NA, NA)
dt_5$Wet <- as.numeric(dt_5$Wet)
dt_5$Dry <- as.numeric(dt_5$Dry)

dt_5$Star <- NA
dt_5$Star <- c("*", NA, NA, "*", "*", NA)

pdat22 <- df %>%
  group_by(Condition, s) %>%
  do(data.frame(loc = density(.$e, na.rm = T)$x,
                dens = density(.$e, na.rm = T)$y))

pdat22$dens[pdat22$Condition == "Wet"] <- pdat22$dens[pdat22$Condition == "Wet"]*-1

pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Dry"]/
  max(pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Dry"]))+1

pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Dry"]))+4

pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Dry"]))+7

pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Dry"]))+10

pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Dry"]/
  max(pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Dry"]))+13

pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Dry"] <- 
  (pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Dry"]/
     max(pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Dry"]))+16

pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Wet"] <- 
  (-pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Wet"]/
  min(pdat22$dens[pdat22$s == "Virginia" & pdat22$Condition == "Wet"])+1)

pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Wet"] <- 
  ((-pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Shortleaf" & pdat22$Condition == "Wet"]))+4)

pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Wet"] <- 
 ((-pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Loblolly2" & pdat22$Condition == "Wet"]))+7)

pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Wet"] <- 
  ((-pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Loblolly1" & pdat22$Condition == "Wet"]))+10)

pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Wet"] <- 
  ((-pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Wet"]/
  min(pdat22$dens[pdat22$s == "Slash" & pdat22$Condition == "Wet"]))+13)

pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Wet"] <- 
 ((-pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Wet"]/
     min(pdat22$dens[pdat22$s == "Longleaf" & pdat22$Condition == "Wet"]))+16)

el22 <- ggplot(data = pdat22, aes(dens, loc, fill = s, alpha = Condition)) + 
  geom_polygon() + labs(x = "Species" , y = bquote(E[L[Max]] ~ "( mm" ~ d^{-1} ~ ")")) + scale_x_continuous(breaks=seq(1,16,3), labels = speclabels) + 
  theme_few() +  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=22,b=0)), title = element_text(size = 26), axis.title.x.bottom = element_blank(),  axis.text.x = element_text(size = 24),  axis.title.x =  element_text(margin = margin(t = 15, r = 0, b = 0, l = 0)), axis.text.y = element_text(size = 22, colour = 'black'), axis.title.y = element_text(size = 24, color = 'white'), legend.position = c(0.2, 0.825)) + 
  guides(fill = 'none', alpha='none') + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("Wet", "Dry"), labels = c("Moist Condition", "Dry Condition")) + 
  ggtitle("  ") + 
  scale_fill_manual(values = c("Virginia" = "#1874cd", "Shortleaf" = "#1874cd", "Loblolly2" = "#1874cd", "Loblolly1" = "#1874cd", "Slash" = "#1874cd", "Longleaf" = "#1874cd"), labels = c("P. virginiana", "P. echinata", "P. taeda", "P. elliottii", "P. palustris"), breaks = c("Virginia", "Shortleaf", "Loblolly", "Slash", "Longleaf")) + 
  annotate('text', x = 15, y = 3, label = yr, size = 9) + 
  scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,3), position = 'right')  + annotate("text", x = seq(1,16,3), y = (dt_5$Wet)+1, cex = 9, label = dt_5$Star, col = c('#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd', '#1874cd')) + annotate('text', x = 0.15, y = 3, label = "J", cex = 8, fontface = 'bold')
```

```{r save 2}
ggsave(filename = "figure_2a.png", 
       plot = js18,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2b.png", 
       plot = js19,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2c.png", 
       plot = js20,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2d.png", 
       plot = js21,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2e.png", 
       plot = js22,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2f_b.png", 
       plot = el18,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2g_b.png", 
       plot = el19,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2h_b.png", 
       plot = el20,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2i_b.png", 
       plot = el21,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "figure_2j_b.png", 
       plot = el22,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

Results of hydraulic measurement campaign.
```{r fig 3a-b}
wpdata <- read.csv("hydraulics.csv")

wpdata$midday <- -wpdata$midday
wpdata$predawn <- -wpdata$predawn

wpdata_wet <- subset(wpdata, wpdata$condition == "wet")
wpdata_dry <- subset(wpdata, wpdata$condition == "zdry")

wp.w <- group_by(wpdata_wet, tree) %>%
  summarise(m=mean(predawn, na.rm = T), s=sd(predawn, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))

plot(wpdata_wet$predawn~wpdata_wet$needle)

summary(lm(wpdata_wet$predawn~wpdata_wet$needle))
summary(lm(wpdata_dry$predawn~wpdata_dry$needle))

summary(lm(wpdata_wet$ktree~wpdata_wet$needle))
summary(lm(wpdata_dry$ktree~wpdata_dry$needle))

needlex <- seq(7, 35, 0.1)
wp.w.sum <- data.frame(needle = needlex, line = (-0.216667-0.001376*needlex))

wp.d <- group_by(wpdata_dry, tree) %>%
  summarise(m=mean(predawn, na.rm = T), s=sd(predawn, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))

needlex <- seq(7, 35, 0.1)
wp.d.sum <- data.frame(needle = needlex, line = (-1.124116+0.008579*needlex))

wp.w$Soil <- "Wet"
wp.d$Soil <- "Dry"

wp.w.sum$Soil <- "Wet"
wp.d.sum$Soil <- "Dry"

wp <- rbind(wp.w, wp.d)
wp.sum <- rbind(wp.w.sum, wp.d.sum)

w.pdata_wet <- subset(wpdata, wpdata$condition == "wet")
w.pdata_dry <- subset(wpdata, wpdata$condition == "zdry")

w.p_w <- group_by(w.pdata_wet, tree) %>%
  summarise(m=mean(midday, na.rm = T), s=sd(midday, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))

plot(w.pdata_wet$midday~w.pdata_wet$needle)

summary(lm(w.pdata_wet$midday~w.pdata_wet$needle))

needlex <- seq(7, 35, 0.1)
w.p_w.sum <- data.frame(needle = needlex, line = (-2.360101+0.027341*needlex))

w.p_d <- group_by(w.pdata_dry, tree) %>%
  summarise(m=mean(midday, na.rm = T), s=sd(midday, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))


plot(w.pdata_dry$midday~w.pdata_dry$needle)

summary(lm(w.pdata_dry$midday~w.pdata_dry$needle))

needlex <- seq(7, 35, 0.1)
w.p_d.sum <- data.frame(needle = needlex, line = (-2.581608+0.025849*needlex))

w.p_w$Soil <- "Wet"
w.p_d$Soil <- "Dry"

w.p_w.sum$Soil <- "Wet"
w.p_d.sum$Soil <- "Dry"

w.p <- rbind(w.p_w, w.p_d)
w.p.sum <- rbind(w.p_w.sum, w.p_d.sum)

pd <- ggplot() + 
  geom_point(data = wp[wp$Soil == "Wet",], aes(x = needle, y = m, col = tree), size = 6) +
  geom_point(data = wp[wp$Soil == "Dry",], aes(x = needle, y = m, col = tree), size = 5, pch = 21, stroke = 2) +
  geom_line(data = wp.w.sum, aes(x = needlex, y = line), linetype = 2) +
  geom_line(data = wp.d.sum, aes(x = needlex, y = line)) +
    geom_errorbar(data = wp.w, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = wp.w, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) + annotate("text", x=30, y=-0.15, label= "p = 0.358", cex = 7) +
  geom_errorbar(data = wp.d, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = wp.d, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) + theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=0,b=0)), title = element_text(size = 32), 
axis.text.x = element_blank(), axis.title.x = element_blank(),  
axis.text.y = element_text(size = 28, colour = 'black'), 
legend.position = 'none') + labs(y = bquote("Ψ" ~  "(MPa)")) + ggtitle(" ")  + scale_shape_manual(name = "Soil Moisture", labels = c("Moist Soil", "Dry Soil"), values = c(19, 17))  + scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(-2.6,0)) + guides(shape = guide_legend(title="Soil Moisture"), col = 'none') +scale_color_discrete(type = c("#66A61E", "#D95F02", "#E6AB02", "#E7298A", "#7570B3", '#1B9E77')) + scale_x_continuous(labels = scales::number_format(accuracy = 1), limits = c(0,40), breaks = c(0, 10, 20, 30, 40))  + geom_point(data = w.p[w.p$Soil == "Wet",], aes(x = needle, y = m, col = tree), size = 6) +
  geom_point(data = w.p[wp$Soil == "Dry",], aes(x = needle, y = m, col = tree), size = 5, pch = 21, stroke = 2) +
  geom_line(data = w.p_w.sum, aes(x = needlex, y = line), linetype = 1) +
  geom_line(data = w.p_d.sum, aes(x = needlex, y = line)) +
    geom_errorbar(data = w.p_w, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = w.p_w, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) + geom_errorbar(data = w.p_d, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = w.p_d, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd))  + annotate("text", x=3, y=-2.305, label= bquote('MD'), cex = 8) + annotate("text", x=3, y=-0.75, label= bquote('PD'), cex = 8) + annotate('text', x = 0.15, y = 0, label = "A", cex = 8, fontface = 'bold') + annotate("text", x=13, y=-1.75, label= bquote(R^{2} ~ "= 0.73"), cex = 6) + 
annotate("text", x=28, y=-2.05, label= bquote(R^{2} ~ "= 0.68"), cex = 6) + annotate("text", x=28, y=-1.05, label= bquote(R^{2} ~ "= 0.33"), cex = 6)

##gradient
w_pdata_wet <- subset(wpdata, wpdata$condition == "wet")
w_pdata_dry <- subset(wpdata, wpdata$condition == "zdry")

w_p.w <- group_by(w_pdata_wet, tree) %>%
  summarise(m=mean(gradient, na.rm = T), s=sd(gradient, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))

plot(w_pdata_wet$gradient~w_pdata_wet$needle)

summary(lm(w_pdata_wet$gradient~w_pdata_wet$needle))

needlex <- seq(7, 35, 0.1)
w_p.w.sum <- data.frame(needle = needlex, line = (2.143434-0.028717*needlex))

w_p.d <- group_by(w_pdata_dry, tree) %>%
  summarise(m=mean(gradient, na.rm = T), s=sd(gradient, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))


plot(w_pdata_dry$gradient~w_pdata_dry$needle)

summary(lm(w_pdata_dry$gradient~w_pdata_dry$needle))

needlex <- seq(7, 35, 0.1)
w_p.d.sum <- data.frame(needle = needlex, line = (1.457492-0.017271*needlex))

w_p.w$Soil <- "Wet"
w_p.d$Soil <- "Dry"

w_p.w.sum$Soil <- "Wet"
w_p.d.sum$Soil <- "Dry"

w_p <- rbind(w_p.w, w_p.d)
w_p.sum <- rbind(w_p.w.sum, w_p.d.sum)

grad <- ggplot() + 
  geom_point(data = w_p[w_p$Soil == "Wet",], aes(x = needle, y = m, col = tree), size = 6) +
  geom_point(data = w_p[w_p$Soil == "Dry",], aes(x = needle, y = m, col = tree), size = 5, pch = 21, stroke = 2) + geom_line(data = w_p.w.sum, aes(x = needlex, y = line), linetype = 1) +
  geom_line(data = w_p.d.sum, aes(x = needlex, y = line)) +
    geom_errorbar(data = w_p.w, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = w_p.w, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) +
  geom_errorbar(data = w_p.d, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = w_p.d, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) +
  theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 34),  axis.title.x =  element_text(size = 28, colour = 'black'), axis.text.x = element_text(size = 30, colour = 'black'),  axis.text.y = element_text(size = 28, colour = 'black'), 
legend.position = 'none') + labs(y = bquote("ΔΨ (MPa)")) + scale_shape_manual(name = "Soil Moisture", labels = c("Moist Soil", "Dry Soil"), values = c(19, 17)) + guides(shape = guide_legend(title="Soil Moisture"), col = 'none') + scale_color_discrete(type = c("#66A61E", "#D95F02", "#E6AB02", "#E7298A", "#7570B3", '#1B9E77'))+ scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0, 2.25)) + labs(x = "Needle Length (cm)") + annotate('text', x = 0.15, y = 2.25, label = "B", cex = 8, fontface = 'bold') + scale_x_continuous(labels = scales::number_format(accuracy = 1), limits = c(0,40), breaks = c(0, 10, 20, 30, 40)) + annotate('text', x = 28, y = .8, label = bquote(R^{2} ~ "= 0.50"), cex = 6) + 
  annotate('text', x = 15, y = 2, label = bquote(R^{2} ~ "= 0.72"), cex = 6) 

fig3 <- plot_grid(pd, grad, align = "v", ncol = 1, rel_heights = c(0.485, 0.515))
```

```{r save 3ab}
ggsave(filename = "figure3a_final.png", 
       plot = fig3,
       width = 20, 
       height = 40,
       units = "cm",
       dpi = 600)
```

```{r fig 3c-d}
## transpiration
wpdata_wet <- subset(wpdata, wpdata$condition == "wet")
wpdata_dry <- subset(wpdata, wpdata$condition == "zdry")

wp.w <- group_by(wpdata_wet, tree) %>%
  summarise(m=mean(transpiration, na.rm = T), s=sd(transpiration, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))

plot(wpdata_wet$transpiration~wpdata_wet$needle)

summary(lm(wpdata_wet$transpiration~wpdata_wet$needle))

needlex <- seq(7, 35, 0.1)
wp.w.sum <- data.frame(needle = needlex, line = (1.173394+0.006346*needlex))

wp.d <- group_by(wpdata_dry, tree) %>%
  summarise(m=mean(transpiration, na.rm = T), s=sd(transpiration, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))

plot(wpdata_dry$transpiration~wpdata_dry$needle)

summary(lm(wpdata_dry$transpiration~wpdata_dry$needle))

needlex <- seq(7, 35, 0.1)
wp.d.sum <- data.frame(needle = needlex, line = (0.346505+0.001679*needlex))

wp.w$Soil <- "Wet"
wp.d$Soil <- "Dry"

wp.w.sum$Soil <- "Wet"
wp.d.sum$Soil <- "Dry"

wp <- rbind(wp.w, wp.d)
wp.sum <- rbind(wp.w.sum, wp.d.sum)

tran <- ggplot() + geom_line(data = wp.w.sum, aes(x = needle, y = line), linetype = 'dashed') + ggtitle("Duke Forest, 2015, 2017")  +
  geom_line(data = wp.d.sum, aes(x = needle, y = line), linetype = 'dashed') +
  geom_point(data = wp[wp$Soil == "Wet",], aes(x = needle, y = m, col = tree), size = 6) +
  geom_point(data = wp[wp$Soil == "Dry",], aes(x = needle, y = m, col = tree), size = 5, pch = 21, stroke = 2) +
  geom_errorbar(data = wp.w, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = wp.w, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) + annotate("text", x=29, y=1.25, label= "p = 0.196", cex = 7.5, col = 'black') +
  geom_errorbar(data = wp.d, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = wp.d, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) + annotate("text", x=29, y=0.3, label= "p = 0.584", cex = 7.5, col = 'black') +
  theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=0,b=0)), title = element_text(size = 28), axis.text.x = element_blank(),  axis.text.y = element_text(size = 28, colour = 'black'), legend.title = element_blank(),
                      legend.text = element_text(size = 30),
 axis.title.x = element_blank()) + theme(legend.position = c(0.8, 0.92))   + labs(x = "Needle Length (cm)", y = bquote(E[L]  ~ "(" ~ mmol ~ m^{-2} ~ s^{-1} ~ ")")) + scale_shape_manual(name = "Soil Moisture", labels = c("Moist Soil", "Dry Soil"), values = c(19, 17)) + scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,2)) + scale_color_discrete(type = c("#66A61E", "#D95F02", "#E6AB02", "#E7298A", "#7570B3", '#1B9E77')) + guides(col = 'none') + scale_x_continuous(labels = scales::number_format(accuracy = 1), limits = c(0,40), breaks = c(0, 10, 20, 30, 40)) + annotate('text', x = 0.15, y = 2, label = "C", cex = 8, fontface = 'bold')

0.1955 #wet
0.5837 #dry

### whole plant conductance
w.pdata_wet <- subset(wpdata, wpdata$condition == "wet")
w.pdata_dry <- subset(wpdata, wpdata$condition == "zdry")

w.p.w <- group_by(w.pdata_wet, tree) %>%
  summarise(m=mean(ktree, na.rm = T), s=sd(ktree, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))

plot(w.pdata_wet$ktree~w.pdata_wet$needle)

summary(lm(w.pdata_wet$ktree~w.pdata_wet$needle))

needlex <- seq(7, 35, 0.001)
w.p.w.sum <- data.frame(needle = needlex, line = (0.436309+0.021781*needlex))

w.p.d <- group_by(w.pdata_dry, tree) %>%
  summarise(m=mean(ktree, na.rm = T), s=sd(ktree, na.rm = T),
            needle=mean(needle), nsd=mean(needlese))


plot(w.pdata_dry$ktree~w.pdata_dry$needle)

summary(lm(w.pdata_dry$ktree~w.pdata_dry$needle))

needlex <- seq(7, 35, 0.001)
w.p.d.sum <- data.frame(needle = needlex, line = (0.226408+0.006454*needlex))

w.p.w$Soil <- "Wet"
w.p.d$Soil <- "Dry"

w.p.w.sum$Soil <- "Wet"
w.p.d.sum$Soil <- "Dry"

w.p <- rbind(w.p.w, w.p.d)
w.p.sum <- rbind(w.p.w.sum, w.p.d.sum)

wpc <- ggplot() + 
  geom_point(data = w.p[w.p$Soil == "Wet",], aes(x = needle, y = m, col = tree), size = 6) +
  geom_line(data = w.p.w.sum, aes(x = needlex, y = line), linetype = 1) +
  geom_point(data = w.p[w.p$Soil == "Dry",], aes(x = needle, y = m, col = tree), size = 5, pch = 21, stroke = 2) + geom_line(data = w.p.d.sum, aes(x = needlex, y = line)) +
  geom_errorbar(data = w.p.w, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = w.p.w, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) +
  geom_errorbar(data = w.p.d, aes(x = needle, y = m, ymin = m - s, ymax = m + s)) +
  geom_errorbar(data = w.p.d, aes(x = needle, y = m, xmin = needle - nsd, xmax = needle + nsd)) +
  theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 32), 
axis.text.x = element_text(size = 30, colour = 'black'), axis.text.y = element_text(size = 28, colour = 'black'), legend.position = 'none') + scale_shape_manual(name = "Soil Moisture", labels = c("Moist Soil", "Dry Soil"), values = c(19, 17)) + scale_x_continuous(breaks = seq(0, 40, 5)) + scale_y_continuous(labels = scales::number_format(accuracy = 0.01), limits = c(0,2)) + scale_color_discrete(type = c("#66A61E", "#D95F02", "#E6AB02", "#E7298A", "#7570B3", '#1B9E77')) + guides(shape = guide_legend(title="Soil Moisture"), col = 'none') + labs(x = "Needle Length (cm)", y = bquote(K[Plant] ~ "(" ~ mmol ~ m^{-2} ~ s^{-1} ~ Mpa^{-1} ~ ")")) + scale_x_continuous(labels = scales::number_format(accuracy = 1), limits = c(0,40), breaks = c(0, 10, 20, 30, 40)) + annotate('text', x = 28, y = 1.2, label = bquote(R^{2} ~ "= .58"), cex = 6) +
   annotate('text', x = 29, y = .3, label = bquote(R^{2} ~ "= .13"), cex = 6)  + annotate('text', x = 0.15, y = 2, label = "D", cex = 8, fontface = 'bold')



fig3b <- plot_grid(tran, wpc, align = "v", ncol = 1, rel_heights = c(0.485, 0.515))
```

```{r save 3cd}
ggsave(filename = "figure3b_final.png", 
       plot = fig3b,
       width = 20, 
       height = 40,
       units = "cm",
       dpi = 600)
```

The relationship between water uptake metrics and needle length.
```{r figure 4}
pdat_fig5_1 <- dt_all %>%
  group_by(s) %>%
  do(data.frame(loc = density(.$j, na.rm = T)$x,
                dens = density(.$j, na.rm = T)$y))
pdat_fig5_1$Condition <- NA
pdat_fig5_1$Condition <- "Wet"

pdat_fig5_2 <- dd_all %>%
  group_by(s) %>%
  do(data.frame(loc = density(.$j, na.rm = T)$x,
                dens = density(.$j, na.rm = T)$y))
pdat_fig5_2$Condition <- NA
pdat_fig5_2$Condition <- "Dry"

pdat_fig5 <- rbind(pdat_fig5_1, pdat_fig5_2)

pdat_fig5$dens[pdat_fig5$Condition == "Wet"] <- 
  pdat_fig5$dens[pdat_fig5$Condition == "Wet"]*-1

pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Virginia"] <- 
  (pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Virginia"]/
  max(pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Virginia"]))+7.51

pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Shortleaf"] <- 
  (pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Shortleaf"]/
  max(pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Shortleaf"]))+9.28 

pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Loblolly2"] <- 
  (pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Loblolly2"]/
  max(pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Loblolly2"]))+17.32

pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Loblolly1"] <- 
  (pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Loblolly1"]/
  max(pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Loblolly1"]))+19.69

pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Slash"] <- 
  (pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Slash"]/
  max(pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Slash"]))+23.23

pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Longleaf"] <- 
  (pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Longleaf"]/
  max(pdat_fig5$dens[pdat_fig5$Condition == "Dry" & pdat_fig5$s == "Longleaf"]))+34.59  

pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Virginia"] <- 
  (-pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Virginia"]/
  min(pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Virginia"]))+7.51

pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Shortleaf"] <- 
  (-pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Shortleaf"]/
  min(pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Shortleaf"]))+9.28 

pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Loblolly2"] <- 
  (-pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Loblolly2"]/
  min(pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Loblolly2"]))+17.32

pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Loblolly1"] <- 
  (-pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Loblolly1"]/
  min(pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Loblolly1"]))+19.69

pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Slash"] <- 
  (-pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Slash"]/
  min(pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Slash"]))+23.23

pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Longleaf"] <- 
  (-pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Longleaf"]/
  min(pdat_fig5$dens[pdat_fig5$Condition == "Wet" & pdat_fig5$s == "Longleaf"]))+34.59 

summary(lm(dt_all$j~dt_all$n)) #0.971
summary(lm(dt_all$e~dt_all$n)) #0.157

summary(lm(dd_all$j~dd_all$n)) #0.005
summary(lm(dd_all$e~dd_all$n)) #0.007

x <- seq(7.5, 35, 0.01)
pred_5a <- data.frame(main = x, 
                      pred1 = 2.2432525-0.0001293*x,
                      pred2 = 1.646660-0.008984*x,
                      s = NA,
                      Condition = NA)

plot(dd_all$j~dd_all$n)
points(x, pred_5a$pred2)

x <- seq(7.5, 35, 0.01)
pred_5b <- data.frame(main = x, 
                      pred1 = 0.665910+0.001986*x,
                      pred2 = 0.532415-0.004110*x,
                      s = NA,
                      Condition = NA)


pdat_fig5b_1 <- dt_all %>%
  group_by(s) %>%
  do(data.frame(loc = density(.$e, na.rm = T)$x,
                dens = density(.$e, na.rm = T)$y))
pdat_fig5b_1$Condition <- NA
pdat_fig5b_1$Condition <- "Wet"

pdat_fig5b_2 <- dd_all %>%
  group_by(s) %>%
  do(data.frame(loc = density(.$e, na.rm = T)$x,
                dens = density(.$e, na.rm = T)$y))
pdat_fig5b_2$Condition <- NA
pdat_fig5b_2$Condition <- "Dry"

pdat_fig5b <- rbind(pdat_fig5b_1, pdat_fig5b_2)

pdat_fig5b$dens[pdat_fig5b$Condition == "Wet"] <- 
  pdat_fig5b$dens[pdat_fig5b$Condition == "Wet"]*-1

pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Virginia"] <- 
  (pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Virginia"]/
  max(pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Virginia"]))+7.51

pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Shortleaf"] <- 
  (pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Shortleaf"]/
  max(pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Shortleaf"]))+9.28 

pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Loblolly2"] <- 
  (pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Loblolly2"]/
  max(pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Loblolly2"]))+17.32

pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Loblolly1"] <- 
  (pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Loblolly1"]/
  max(pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Loblolly1"]))+19.69

pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Slash"] <- 
  (pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Slash"]/
  max(pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Slash"]))+23.23

pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Longleaf"] <- 
  (pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Longleaf"]/
  max(pdat_fig5b$dens[pdat_fig5b$Condition == "Dry" & pdat_fig5b$s == "Longleaf"]))+34.59  

pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Virginia"] <- 
  (-pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Virginia"]/
  min(pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Virginia"]))+7.51

pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Shortleaf"] <- 
  (-pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Shortleaf"]/
  min(pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Shortleaf"]))+9.28 

pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Loblolly2"] <- 
  (-pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Loblolly2"]/
  min(pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Loblolly2"]))+17.32

pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Loblolly1"] <- 
  (-pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Loblolly1"]/
  min(pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Loblolly1"]))+19.69

pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Slash"] <- 
  (-pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Slash"]/
  min(pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Slash"]))+23.23

pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Longleaf"] <- 
  (-pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Longleaf"]/
  min(pdat_fig5b$dens[pdat_fig5b$Condition == "Wet" & pdat_fig5b$s == "Longleaf"]))+34.59  

fig4a <- ggplot(data = pdat_fig5, aes(dens, loc, fill = as.factor(s), alpha = Condition)) + 
  geom_polygon() + geom_line(data = pred_5a, aes(x = main, y = pred1), linetype = 2) + geom_line(data = pred_5a, aes(x = main, y = pred2), linetype = 1) + 
  labs(x = "Year" , y = bquote(J[S] ~ "(" ~ m^{3} ~ m^{-2} ~ d^{-1} ~ ")")) + 
  scale_x_continuous(breaks=seq(1,13,3), labels = yrlabels) + 
  theme_few()  +
  theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 30),  axis.title.x =  element_blank(), 
axis.title.y = element_text(size = 30), axis.text.y.left = element_text(size = 30, colour = 'black'),
legend.text = element_text(size = 24), legend.title = element_blank(), axis.text.x = element_blank(), legend.position = c(0.875, 0.925)) + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("All Soil Conditions", "Dry Soil"), labels = c("Moist Soil", "Dry Soil")) + ggtitle("Duke Forest, 2018-2022") + 
  guides(alpha=guide_legend(title="Soil Moisture"), fill = 'none') + 
  scale_fill_discrete(type = c("#E7298A", "#7570B3", "#E6AB02", "#D95F02", "#66A61E",  '#1B9E77')) + lims(x = c(0, 40)) + 
  annotate("text", x=29, y=2.5, label= "p = 0.971", cex = 8.5) +
  annotate("text", x=29.5, y=1.1, label= "p = 0.005", cex = 8.5) +
  annotate("text", x=29.4, y=0.8, label= bquote(R^{2} ~ " = 0.025"), cex = 6.5) +
  scale_y_continuous(labels = scales::number_format(accuracy = 0.1)) + annotate('text', x = 0.15, y = 4, label = "A", cex = 8, fontface = 'bold')

fig4b <- ggplot(data = pdat_fig5b, aes(dens, loc, fill = as.factor(s), alpha = Condition)) + geom_polygon() + labs(x = "Needle Length (cm)" , y = bquote(E[L] ~ "(mm" ~ d^{-1} ~ ")")) + theme_few()  + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=0,b=0)), title = element_text(size = 30),  
axis.title.x =  element_text(size = 30), 
axis.title.y = element_text(size = 30),
axis.text.y.left = element_text(size = 30, colour = 'black'),
legend.text = element_text(size = 24), legend.title = element_blank(), axis.text.x = element_text(size = 30, colour = 'black'), legend.position = c(0.875, 0.925)) + scale_alpha_discrete(range = c(0.3, 0.9), breaks = c("All Soil Conditions", "Dry Soil"), labels = c("Moist Soil", "Dry Soil"))  + guides(fill = 'none', alpha=guide_legend(title="Soil Moisture")) + lims(x = c(0, 40)) + geom_line(data = pred_5b, aes(x = main, y = pred1), linetype = 2) + geom_line(data = pred_5b, aes(x = main, y = pred2), linetype = 1) + 
  annotate("text", x=28.5, y=0.85, label= "p = 0.636", cex = 8.5) +
  annotate("text", x=29, y=0.3, label= "p = 0.001", cex = 8.5) +
  annotate("text", x=29.4, y=0.175, label= bquote(R^{2} ~ " = 0.031"), cex = 6.5) + scale_fill_discrete(type = c("#E7298A", "#7570B3", "#E6AB02", "#D95F02", "#66A61E",  '#1B9E77')) + annotate('text', x = 0.15, y = 1.5, label = "B", cex = 8, fontface = 'bold') + lims(y = c(0, 1.5))


fig4 <- plot_grid(fig4a, fig4b, align = "v", ncol = 1, rel_heights = c(.475, 0.525))
```

```{r save 4}
ggsave(filename = "fig4_final.png", 
       plot = fig4,
       width = 20, 
       height = 40,
       units = "cm",
       dpi = 600)
```

The trajectory of hydraulic variables under wet conditions.
```{r figure 5}
dt1 <- dt_virg_sum

dt1$as <- dt1$as/dt1$as[dt1$y == 2018]
dt1$grad <- dt1$grad/dt1$grad[dt1$y == 2018]
dt1$path <- dt1$path/dt1$path[dt1$y == 2018]
dt1$lump <- dt1$lump/dt1$lump[dt1$y == 2018]
dt1$js.adj <- dt1$js/dt1$js[dt1$y == 2018]
dt1$js.sd <- (dt1$jse/dt1$js)*dt1$js.adj

fig5a <- ggplot(dt1) +
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021.5, y = 1.1, label = bquote(A[S] ~ "/" ~ A[L]) , col = shortleaffill, cex = 5) +
  annotate('text', x = 2021.5, y = 1.02, label = 'ΔΨ', col = virginiafill, cex = 5) +
  annotate('text', x = 2020.75, y = 0.55, label = '1/h', col = lob2fill, cex = 5) +
  annotate('text', x = 2021.25, y = 0.65, label = "KL'", col = lob1fill, cex = 5) +
  annotate('text', x = 2020.5, y = 0.78, label = bquote(J[S]), col = slashfill, cex = 5) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus virginiana", col = virginiafill, cex = 8, fontface = 'italic') + scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.25)) + annotate('text', x = 2017.75, y = 1.25, label = "A", cex = 8, fontface = 'bold')

dt2 <- dt_short_sum

dt2$as <- dt2$as/dt2$as[dt2$y == 2018]
dt2$grad <- dt2$grad/dt2$grad[dt2$y == 2018]
dt2$path <- dt2$path/dt2$path[dt2$y == 2018]
dt2$lump <- dt2$lump/dt2$lump[dt2$y == 2018]
dt2$js <- dt2$js/dt2$js[dt2$y == 2018]
dt2$js.adj <- dt2$js/dt2$js[dt2$y == 2018]
dt2$js.sd <- (dt2$jse/dt2$js)*dt2$js.adj

fig5b <- ggplot(dt2) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("Duke Forest, 2018-2022") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus echinata", col = shortleaffill, cex = 8, fontface = 'italic')  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.25)) + annotate('text', x = 2017.75, y = 1.25, label = "B", cex = 8, fontface = 'bold')


dt3 <- dt_lob2_sum

dt3$as <- dt3$as/dt3$as[dt3$y == 2018]
dt3$grad <- dt3$grad/dt3$grad[dt3$y == 2018]
dt3$path <- dt3$path/dt3$path[dt3$y == 2018]
dt3$lump <- dt3$lump/dt3$lump[dt3$y == 2018]
dt3$js <- dt3$js/dt3$js[dt3$y == 2018]
dt3$js.adj <- dt3$js/dt3$js[dt3$y == 2018]
dt3$js.sd <- (dt3$jse/dt3$js)*dt3$js.adj

fig5c <- ggplot(dt3) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus taeda (2)", col = lob2fill, cex = 8, fontface = 'italic')  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.25)) + annotate('text', x = 2017.75, y = 1.25, label = "C", cex = 8, fontface = 'bold')

dt4 <- dt_lob1_sum

dt4$as <- dt4$as/dt4$as[dt4$y == 2018]
dt4$grad <- dt4$grad/dt4$grad[dt4$y == 2018]
dt4$path <- dt4$path/dt4$path[dt4$y == 2018]
dt4$lump <- dt4$lump/dt4$lump[dt4$y == 2018]
dt4$js.adj <- dt4$js/dt4$js[dt4$y == 2018]
dt4$js.sd <- (dt4$jse/dt4$js)*dt4$js.adj

fig5d <- ggplot(dt4) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("")  + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus taeda (1)", col = lob1fill, cex = 8, fontface = 'italic')  + scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.25)) + annotate('text', x = 2017.75, y = 1.25, label = "D", cex = 8, fontface = 'bold')


dt5 <- dt_slash_sum

dt5$as <- dt5$as/dt5$as[dt5$y == 2018]
dt5$grad <- dt5$grad/dt5$grad[dt5$y == 2018]
dt5$path <- dt5$path/dt5$path[dt5$y == 2018]
dt5$lump <- dt5$lump/dt5$lump[dt5$y == 2018]
dt5$js.adj <- dt5$js/dt5$js[dt5$y == 2018]
dt5$js.sd <- (dt5$jse/dt5$js)*dt5$js.adj

fig5e <- ggplot(dt5) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus elliottii", col = slashfill, cex = 8, fontface = 'italic')  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.25)) + annotate('text', x = 2017.75, y = 1.25, label = "E", cex = 8, fontface = 'bold')


dt6 <- dt_long_sum

dt6$as <- dt6$as/dt6$as[dt6$y == 2018]
dt6$grad <- dt6$grad/dt6$grad[dt6$y == 2018]
dt6$path <- dt6$path/dt6$path[dt6$y == 2018]
dt6$lump <- dt6$lump/dt6$lump[dt6$y == 2018]
dt6$js.adj <- dt6$js/dt6$js[dt6$y == 2018]
dt6$js.sd <- (dt6$jse/dt6$js)*dt6$js.adj

fig5f <- ggplot(dt6) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + lims(x = c(2018, 2022)) +
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus palustris", col = longfill, cex = 8, fontface = 'italic')  + scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.25)) + annotate('text', x = 2018, y = 1.25, label = "F", cex = 8, fontface = 'bold')


dttt <- rbind(dt1, dt2, dt3, dt4, dt5, dt6)
write.csv(dttt, "dttt.csv")
```

```{r save 5}
ggsave(filename = "fig5a_final.png", 
       plot = fig5a,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5b_final.png", 
       plot = fig5b,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5c_final.png", 
       plot = fig5c,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5d_final.png", 
       plot = fig5d,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5e_final.png", 
       plot = fig5e,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5f_final.png", 
       plot = fig5f,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

Trajectory of hydraulic variables under dry conditions.
```{r figure S2}
dd1 <- dd_virg_sum

dd1$as <- dd1$as/dd1$as[dd1$y == 2018]
dd1$grad <- dd1$grad/dd1$grad[dd1$y == 2018]
dd1$path <- dd1$path/dd1$path[dd1$y == 2018]
dd1$lump <- dd1$lump/dd1$lump[dd1$y == 2018]
dd1$js.adj <- dd1$js/dd1$js[dd1$y == 2018]
dd1$js.sd <- (dd1$jse/dd1$js)*dd1$js.adj

fig5a_s <- ggplot(dd1) +
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021.5, y = 1.05, label = bquote(A[S] ~ "/" ~ A[L]) , col = shortleaffill, cex = 5) +
  annotate('text', x = 2021.5, y = 1, label = 'ΔΨ', col = virginiafill, cex = 5) +
  annotate('text', x = 2020.75, y = 0.55, label = '1/h', col = lob2fill, cex = 5) +
  annotate('text', x = 2019.5, y = 0.87, label = "KL'", col = lob1fill, cex = 5) +
  annotate('text', x = 2018.35, y = 0.78, label = bquote(J[S]), col = slashfill, cex = 5) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus virginiana", col = virginiafill, cex = 8)  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25), labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.3)) + annotate('text', x = 2017.75, y = 1.25, label = "A", cex = 8, fontface = 'bold')

dd2 <- dd_short_sum

dd2$as <- dd2$as/dd2$as[dd2$y == 2018]
dd2$grad <- dd2$grad/dd2$grad[dd2$y == 2018]
dd2$path <- dd2$path/dd2$path[dd2$y == 2018]
dd2$lump <- dd2$lump/dd2$lump[dd2$y == 2018]
dd2$js <- dd2$js/dd2$js[dd2$y == 2018]
dd2$js.adj <- dd2$js/dd2$js[dd2$y == 2018]
dd2$js.sd <- (dd2$jse/dd2$js)*dd2$js.adj

fig5b_s <- ggplot(dd2) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("Duke Forest, 2018-2022") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus echinata", col = shortleaffill, cex = 8)  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.3)) + annotate('text', x = 2017.75, y = 1.25, label = "B", cex = 8, fontface = 'bold')


dd3 <- dd_lob2_sum

dd3$as <- dd3$as/dd3$as[dd3$y == 2018]
dd3$grad <- dd3$grad/dd3$grad[dd3$y == 2018]
dd3$path <- dd3$path/dd3$path[dd3$y == 2018]
dd3$lump <- dd3$lump/dd3$lump[dd3$y == 2018]
dd3$js <- dd3$js/dd3$js[dd3$y == 2018]
dd3$js.adj <- dd3$js/dd3$js[dd3$y == 2018]
dd3$js.sd <- (dd3$jse/dd3$js)*dd3$js.adj

fig5c_s <- ggplot(dd3) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus taeda (2)", col = lob2fill, cex = 8)  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.3)) + annotate('text', x = 2017.75, y = 1.25, label = "C", cex = 8, fontface = 'bold')

dd4 <- dd_lob1_sum

dd4$as <- dd4$as/dd4$as[dd4$y == 2018]
dd4$grad <- dd4$grad/dd4$grad[dd4$y == 2018]
dd4$path <- dd4$path/dd4$path[dd4$y == 2018]
dd4$lump <- dd4$lump/dd4$lump[dd4$y == 2018]
dd4$js.adj <- dd4$js/dd4$js[dd4$y == 2018]
dd4$js.sd <- (dd4$jse/dd4$js)*dd4$js.adj

fig5d_s <- ggplot(dd4) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus taeda (1)", col = lob1fill, cex = 8)  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.3)) + annotate('text', x = 2017.75, y = 1.25, label = "D", cex = 8, fontface = 'bold')


dd5 <- dd_slash_sum

dd5$as <- dd5$as/dd5$as[dd5$y == 2018]
dd5$grad <- dd5$grad/dd5$grad[dd5$y == 2018]
dd5$path <- dd5$path/dd5$path[dd5$y == 2018]
dd5$lump <- dd5$lump/dd5$lump[dd5$y == 2018]
dd5$js.adj <- dd5$js/dd5$js[dd5$y == 2018]
dd5$js.sd <- (dd5$jse/dd5$js)*dd5$js.adj

fig5e_s <- ggplot(dd5) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + 
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus elliottii", col = slashfill, cex = 8)  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.3)) + annotate('text', x = 2017.75, y = 1.25, label = "E", cex = 8, fontface = 'bold')


dd6 <- dd_long_sum

dd6$as <- dd6$as/dd6$as[dd6$y == 2018]
dd6$grad <- dd6$grad/dd6$grad[dd6$y == 2018]
dd6$path <- dd6$path/dd6$path[dd6$y == 2018]
dd6$lump <- dd6$lump/dd6$lump[dd6$y == 2018]
dd6$js.adj <- dd6$js/dd6$js[dd6$y == 2018]
dd6$js.sd <- (dd6$jse/dd6$js)*dd6$js.adj

fig5f_s <- ggplot(dd6) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_blank(), axis.title.y = element_blank(), plot.title = element_text(size = 26)) + ggtitle("") + lims(x = c(2018, 2022)) +
  labs(x = "Year", y = "Relative Quantity") +
  geom_line(aes(x = y, y = grad), col = virginiafill, lwd = 1.25) + 
  geom_line(aes(x = y, y = as), col = shortleaffill, lwd = 1.25) + 
  geom_line(aes(x = y, y = path), col = lob2fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = lump), col = lob1fill, lwd = 1.25) + 
  geom_line(aes(x = y, y = js.adj), col = slashfill, lwd = 1.5) +
  geom_point(aes(x = y, y = grad), col = virginiafill, size = 3) + 
  geom_point(aes(x = y, y = as), col = shortleaffill, size = 3) + 
  geom_point(aes(x = y, y = path), col = lob2fill, size = 3) + 
  geom_point(aes(x = y, y = lump), col = lob1fill, size = 3) + 
  geom_point(aes(x = y, y = js.adj), col = slashfill, size = 3) +
  geom_errorbar(aes(x = y, y = js.adj, 
  ymin = js.adj - js.sd, ymax = js.adj + js.sd, width = 0.5), col = slashfill) +
  annotate('text', x = 2021, y = 1.25, label = "Pinus palustris", col = longfill, cex = 8)  +
scale_y_continuous(breaks=c(0, .25, .5, .75, 1, 1.25),labels=c("0", "0.25", "0.50", "0.75", "1.00", "1.25"), limits = c(0.25, 1.3)) + annotate('text', x = 2018, y = 1.25, label = "F", cex = 8, fontface = 'bold')

```

```{r save S2 - previously 5s}
ggsave(filename = "fig5a_s_final.png", 
       plot = fig5a_s,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5b_s_final.png", 
       plot = fig5b_s,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5c_s_final.png", 
       plot = fig5c_s,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5d_s_final.png", 
       plot = fig5d_s,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5e_s_final.png", 
       plot = fig5e_s,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig5f_s_final.png", 
       plot = fig5f_s,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

Lumped parameter as a predictor of changes in Js and El.
```{r figure 6}
summary(lm(js~h_rel, data = dt_sum_adj)) #R2 = 0.6886
summary(lm(el~Species+lump_rel, data = dt_sum_adj2)) #R2 = 0.769

dt_sum_adj2$Species <- dt_sum_adj2$species
dt_sum_adj2$Species[dt_sum_adj2$species == "Longleaf" | dt_sum_adj2$species == "Loblolly1" | dt_sum_adj2$species == "Loblolly2"| dt_sum_adj2$species == "Virginia"] <- "Loblolly and Longleaf"
dt_sum_adj2$Species[dt_sum_adj2$species == "Shortleaf" | dt_sum_adj2$species == "Slash"] <- "Virginia, Shortleaf, and Slash"

plot(dt_sum_adj2$lump_rel[dt_sum_adj2$Species == "Loblolly and Longleaf"],
     dt_sum_adj2$el[dt_sum_adj2$Species == "Loblolly and Longleaf"], ylim = c(0, 1.5))
abline(lm(dt_sum_adj2$el[dt_sum_adj2$Species == "Loblolly and Longleaf"]~
            dt_sum_adj2$lump_rel[dt_sum_adj2$Species == "Loblolly and Longleaf"]))
summary(lm(el~Species+lump_rel, data = dt_sum_adj2))

ggplot(dt_sum_adj2, aes(x = lump_rel, y = el, col = Species)) +
  geom_point() + geom_smooth(method = 'lm', se = F) + lims(y = c(0, 1.5))

plot(dt_sum_adj2$lump_rel[dt_sum_adj2$Species == "Virginia, Shortleaf, and Slash"],
     dt_sum_adj2$el[dt_sum_adj2$Species == "Virginia, Shortleaf, and Slash"], ylim = c(0, 1.5))
abline(lm(dt_sum_adj2$el[dt_sum_adj2$Species == "Virginia, Shortleaf, and Slash"]~dt_sum_adj2$lump_rel[dt_sum_adj2$Species == "Virginia, Shortleaf, and Slash"]))
summary(lm(el~lump_rel, data = dt_sum_adj2[dt_sum_adj2$Species == "Virginia, Shortleaf, and Slash",]))

summary(lm(js~d+lump_rel, data = dd_sum_adj)) #R2 = 0.5533  
summary(lm(js~lump_rel, data = dd_sum_adj)) #R2 = 0.4799 
summary(lm(el~Species+d+lump_rel, data = dd_sum_adj)) #R2 = 0.7126  
summary(lm(el~Species+lump_rel, data = dd_sum_adj)) #R2 = 0.561 

summary(lm(js~lump_rel, data = dd_sum_adj))
summary(lm(el~Species+lump_rel, data = dd_sum_adj))

summary(lm(js~lump_rel, data = dd_sum_adj[dd_sum_adj$y != 2018,]))
summary(lm(el~Species+lump_rel, data = dd_sum_adj[dd_sum_adj$y != 2018,]))

summary(lm(js~h_rel, data = dd_sum_adj)) 
summary(lm(el~Species+h_rel, data = dd_sum_adj)) 

summary(lm(js~h_rel, data = dd_sum_adj[dd_sum_adj$y != 2018,]))
summary(lm(el~Species+h_rel, data = dd_sum_adj[dd_sum_adj$y != 2018,])) 

x <- seq(0.447, 1, 0.001)
fig6b_linedf <- data.frame(X = x, 
                          Js.3 = (0.2179+2.1217*x),
                          Js.3b = (1.3946+0.1081*x),
                          El.5 = (-0.11244+0.79596*x),
                          El.6 = (-0.11244+0.16793*x)+(0.79596*x),
                          El.5b = (0.25416+0.17069*x),
                          El.6b = (0.25416+0.16575*x)+(0.17069*x),
                          Js = (0.1259+2.3017*x), 
                          El_1 = (-0.16042+0.86792*x),
                          El_2 = (-0.16042+0.18791)+(0.86792*x),
                          Js.2 = (1.43052+0.05411*x), 
                          El.3 = (0.23977+0.19447*x),
                          El.4 = (0.23977+0.17155)+(0.19447*x),
                          species = NA)

dd_sum_adj$js.adj <- dd_sum_adj$js/dd_sum_adj$d
dd_sum_adj$el.adj <- dd_sum_adj$el/dd_sum_adj$d

dd_sum_adj$Species <- dd_sum_adj$species
dd_sum_adj$Species[dd_sum_adj$species == "Longleaf" | dd_sum_adj$species == "Loblolly1" | dd_sum_adj$species == "Loblolly2"] <- "Loblolly and Longleaf"
dd_sum_adj$Species[dd_sum_adj$species == "Virginia" | dd_sum_adj$species == "Shortleaf" | dd_sum_adj$species == "Slash"] <- "Virginia, Shortleaf, and Slash"
summary(lm(js~h_rel, data = dt_sum_adj))
summary(lm(el~h_rel+Species, data = dt_sum_adj))

(0.06927973)+(0.75912719*x)
(0.06927973+0.17104476)+(0.75912719*x)

x <- seq(0.447, 1, 0.001)
fig6_linedf <- data.frame(X = x, Js = (0.93900+1.8226*x), 
                          El_1 = (0.06928+0.75913*x),
                          El_2 = (0.06928+0.17104)+(0.75913*x),
                          El_1rel = (0.82841*x),
                          El_2rel = (0.99945*x),
                          Js.2 = (0.9390+1.8226*x), 
                          El.3 = (0.05665+0.78530*x),
                          El.4 = ((0.05665+0.17515)+(0.78530*x)),
                          El.3rel = (0.84195*x),
                          El.4rel = (1.0171*x),
                          El.5 = (0.14583+0.17509)+(0.67241*x),
                          El.6 = (0.14583)+(0.67241*x),
                          species = NA)

0.84195*.4
1.0171

dt_sum_adj <- dt_sum_adj %>%
  mutate(species=factor(species,levels=c("Virginia", "Shortleaf", "Loblolly2", "Loblolly1", "Slash", "Longleaf")))

dd_sum_adj <- dd_sum_adj %>%
  mutate(species=factor(species,levels=c("Virginia", "Shortleaf", "Loblolly2", "Loblolly1", "Slash", "Longleaf")))

fig6a <- ggplot(dt_sum_adj[1:28,], aes(x = lump_rel, y = js, col = species)) +
  geom_point(size = 4) +
  lims(y =c(1,3)) + 
  labs(x = "Relative KL'", y = bquote(J[S] ~ "(" ~ m^{3} ~ m^{-2} ~ d^{-1} ~ ")")) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
                      axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("Duke Forest, 2018-2022") +
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal)) +
  geom_line(data = fig6_linedf, aes(x = X, y = Js)) +
  annotate('text', x = 0.9, y = 1.15, label = "p < 0.0001", cex = 8) + 
  annotate('text', x = 0.9, y = 1.3, label = bquote(R^{2} ~ "= 0.67"), cex = 8) + 
  theme(legend.position = 'none', legend.title = element_blank()) +
  annotate('text', x = 0.4, y = 3, label = "C", cex = 8, fontface = 'bold')

virg_teal <- '#1B9E77'
short_orange <- '#D95F02'
lob2_purple <- '#7570B3'
lob1_pink <- '#E7298A'
slash_green <- '#66A61E'
long_gold <- '#E6AB02'

ggplot(dt_sum_adj[1:28,], aes(x = lump_rel, y = el, col = species)) + 
  geom_point(size = 4) + lims(y =c(0,1.25))+
  labs(x = "Relative KL'", y = bquote(E[L] ~ "mm (" ~ d^{-1} ~ ")"))+ theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
  axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + 
  annotate('text', x = 0.5, y = 2.9, label = bquote(R^{2} ~ "= 0.69"), cex = 6) + 
  theme(legend.position = c(0.8, 0.), legend.title = element_blank()) +
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal)) 

ggplot(dt_sum_adj[1:28,], aes(x = lump_rel, y = el, col = species)) + 
  geom_point(size = 4) + lims(y =c(0,1.25))+
  labs(x = "Relative KL'", y = bquote(E[L] ~ "mm (" ~ d^{-1} ~ ")"))+
  geom_line(data = fig6_linedf, aes(x = X, y = El_1))  + geom_line(data = fig6_linedf, aes(x = X, y = El_2))  + theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
  axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + 
  annotate('text', x = 0.5, y = 2.9, label = bquote(R^{2} ~ "= 0.69"), cex = 6) + 
  theme(legend.position = c(0.85, 0.25), legend.title = element_blank()) +
  annotate('text', x = 0.4, y = 1.25, label = "D", cex = 8, fontface = 'bold') + 
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal)) 

ggplot(dt_sum_adj2[1:28,], aes(x = lump_rel, y = el, col = species)) + 
  geom_point(size = 4) + lims(y =c(0,1.25))+
  labs(x = "Relative KL'", y = bquote(E[L] ~ "mm (" ~ d^{-1} ~ ")"))+
  geom_line(data = fig6_linedf, aes(x = X, y = El.5))  + geom_line(data = fig6_linedf, aes(x = X, y = El.6))  + theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
  axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + 
  annotate('text', x = 0.5, y = 2.9, label = bquote(R^{2} ~ "= 0.69"), cex = 6) + 
  theme(legend.position = c(0.85, 0.25), legend.title = element_blank()) +
  annotate('text', x = 0.4, y = 1.25, label = "D", cex = 8, fontface = 'bold') + 
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal)) 

ggplot(dt_sum_adj2[1:28,], aes(x = lump_rel, y = el, col = species)) + 
  geom_point(size = 4) + lims(y =c(0,1.25))+
  labs(x = "Relative KL'", y = bquote(E[L] ~ "mm (" ~ d^{-1} ~ ")"))+
  geom_line(data = fig6_linedf, aes(x = X, y = El_1))  + geom_line(data = fig6_linedf, aes(x = X, y = El_2))  + theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
  axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + 
  annotate('text', x = 0.5, y = 2.9, label = bquote(R^{2} ~ "= 0.69"), cex = 6) + 
  theme(legend.position = c(0.85, 0.25), legend.title = element_blank()) +
  annotate('text', x = 0.4, y = 1.25, label = "D", cex = 8, fontface = 'bold') + 
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal)) 

fig6b <- ggplot(dt_sum_adj[1:28,], aes(x = lump_rel, y = el, col = species)) + 
  geom_point(size = 4) + lims(y =c(0,1.25))+
  labs(x = "Relative KL'", y = bquote(E[L] ~ "mm (" ~ d^{-1} ~ ")"))+
  geom_line(data = fig6_linedf, aes(x = X, y = El_1))  + geom_line(data = fig6_linedf, aes(x = X, y = El_2))  + theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
  axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("") + annotate('text', x = 0.9, y = 0.05, label = "p < 0.0001", cex = 8) + 
  annotate('text', x = 0.5, y = 2.9, label = bquote(R^{2} ~ "= 0.69"), cex = 6) + 
  theme(legend.position = c(0.4, 0.9), legend.title = element_blank()) + 
  annotate('text', x = 0.9, y = 0.15, label = bquote(R^{2} ~ "= 0.77"), cex = 8) +
  annotate('text', x = 0.4, y = 1.25, label = "D", cex = 8, fontface = 'bold') + 
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal))  + guides(color = 'none')  +
  geom_line(data = fig6_linedf, aes(x = X, y = El_1rel), linetype = 'dashed', arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed"))  + 
  geom_line(data = fig6_linedf, aes(x = X, y = El_2rel), linetype = 'dashed', arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed"))

fig6c <- ggplot(dt_sum_adj[1:28,], aes(x = h_rel, y = js, col = species)) +
  geom_point(size = 4) +
  lims(y =c(1,3)) + 
  labs(x = "Relative 1/h", y = bquote(J[S] ~ "(" ~ m^{3} ~ m^{-2} ~ d^{-1} ~ ")")) + 
  theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
                      axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("") +
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal)) +
  geom_line(data = fig6_linedf, aes(x = X, y = Js.2)) +
  annotate('text', x = 0.9, y = 1.15, label = "p < 0.0001", cex = 8) + 
  annotate('text', x = 0.9, y = 1.3, label = bquote(R^{2} ~ "= 0.69"), cex = 8) + 
  theme(legend.position = 'none', legend.title = element_blank()) +
  annotate('text', x = 0.4, y = 3, label = "A", cex = 8, fontface = 'bold')


virg_teal <- '#1B9E77'
short_orange <- '#D95F02'
lob2_purple <- '#7570B3'
lob1_pink <- '#E7298A'
slash_green <- '#66A61E'
long_gold <- '#E6AB02'

fig6d <- ggplot(dt_sum_adj[1:28,], aes(x = h_rel, y = el, col = species)) + 
  geom_point(size = 4) + lims(y =c(0,1.25))+
  labs(x = "Relative 1/h", y = bquote(E[L] ~ "(mm" ~ d^{-1} ~ ")"))+
  geom_line(data = fig6_linedf, aes(x = X, y = El.3))  + geom_line(data = fig6_linedf, aes(x = X, y = El.4))  + theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
  axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("") + annotate('text', x = 0.9, y = 0.05, label = "p < 0.0001", cex = 8) + 
  annotate('text', x = 0.5, y = 2.9, label = bquote(R^{2} ~ "= 0.69"), cex = 6) + 
  theme(legend.position = c(0.4, 0.9), legend.title = element_blank()) + 
  annotate('text', x = 0.9, y = 0.15, label = bquote(R^{2} ~ "= 0.79"), cex = 8) +
  annotate('text', x = 0.4, y = 1.25, label = "B", cex = 8, fontface = 'bold') + 
  scale_color_discrete(type = c(lob1_pink, lob2_purple, long_gold, short_orange, slash_green, virg_teal))  + guides(color = 'none')  +
  geom_line(data = fig6_linedf, aes(x = X, y = El.3rel), linetype = 'dashed', arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed"))  + 
  geom_line(data = fig6_linedf, aes(x = X, y = El.4rel), linetype = 'dashed', arrow = arrow(length=unit(0.30,"cm"), ends="first", type = "closed"))

fig6_a <- ggplot(dd_sum_adj[1:29,], aes(x = lump_rel, y = js, col = species)) +
geom_point(size = 4, alpha = 0.5) + scale_y_continuous(labels = scales::number_format(accuracy = 0.1), limits = c(0,3)) + 
   labs(x = "Relative KL'", y = bquote(J[S] ~ "(" ~ m^{3} ~ m^{-2} ~ d^{-1} ~ ")")) + 
   theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
                       axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("Duke Forest, 2018-2022") +
   scale_color_discrete(type = c(lob1fill, lob2fill, longfill, shortleaffill, slashfill, virginiafill)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = Js.3)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = Js.3b), linetype = 'dashed') +
   annotate('text', x = 0.525, y = 2.6, label = "p < 0.0001", cex = 6) + 
   annotate('text', x = 0.525, y = 2.9, label = bquote(R^{2} ~ "= 0.48"), cex = 8) +
   theme(legend.position = 'none', legend.title = element_blank()) 

 fig6_b <- ggplot(dd_sum_adj2[1:29,], aes(x = lump_rel, y = el, col = species)) + 
   geom_point(size = 4, alpha = 0.5) + lims(y =c(0,1.25)) + 
   scale_color_discrete(type = c(lob1fill, lob2fill, longfill, shortleaffill, slashfill, virginiafill)) +
   labs(x = "Relative KL'", y = bquote(E[L] ~ "mm (" ~ d^{-1} ~ ")")) + 
   theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
   axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("") +
   geom_line(data = fig6b_linedf, aes(x = X, y = El.5)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = El.6)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = El.5b), linetype = 'dashed') +
   geom_line(data = fig6b_linedf, aes(x = X, y = El.6b), linetype = 'dashed') +
   annotate('text', x = 0.55, y = 1.1, label = "p < 0.0001", cex = 6) +  
   theme(legend.position = c(0.4, 0.9), legend.title = element_blank()) + 
   annotate('text', x = 0.55, y = 1.2, label = bquote(R^{2} ~ "= 0.57"), cex = 8) + guides(color = 'none') 
 
 fig6_c <- ggplot(dd_sum_adj[1:29,], aes(x = h_rel, y = js, col = species)) +
geom_point(size = 4, alpha = 0.5) + scale_y_continuous(labels = scales::number_format(accuracy = 0.1), limits = c(0,3)) + 
   labs(x = "Relative 1/h", y = bquote(J[S] ~ "(" ~ m^{3} ~ m^{-2} ~ d^{-1} ~ ")")) + 
   theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
                       axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle(" ") +
   scale_color_discrete(type = c(lob1fill, lob2fill, longfill, shortleaffill, slashfill, virginiafill)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = Js)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = Js.2), linetype = 'dashed') +
   annotate('text', x = 0.525, y = 2.6, label = "p < 0.0001", cex = 6) + 
   annotate('text', x = 0.525, y = 2.9, label = bquote(R^{2} ~ "= 0.55"), cex = 8) + 
   theme(legend.position = 'none', legend.title = element_blank()) 

 fig6_d <- ggplot(dd_sum_adj[1:29,], aes(x = h_rel, y = el, col = species)) + 
   geom_point(size = 4, alpha = 0.5) + lims(y =c(0,1.25)) + 
   scale_color_discrete(type = c(lob1fill, lob2fill, longfill, shortleaffill, slashfill, virginiafill)) +
   labs(x = "Relative 1/h", y = bquote(E[L] ~ "(mm" ~ d^{-1} ~ ")")) + 
   theme_few() + theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22),
   axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24), legend.text = element_text(size = 18), plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("")  +
   geom_line(data = fig6b_linedf, aes(x = X, y = El_1)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = El_2)) +
   geom_line(data = fig6b_linedf, aes(x = X, y = El.3), linetype = 'dashed') +
   geom_line(data = fig6b_linedf, aes(x = X, y = El.4), linetype = 'dashed') +
   annotate('text', x = 0.55, y = 1.1, label = "p < 0.0001", cex = 6) + 
   theme(legend.position = c(0.4, 0.9), legend.title = element_blank()) + 
   annotate('text', x = 0.55, y = 1.2, label = bquote(R^{2} ~ "= 0.64"), cex = 8) + guides(color = 'none')
```

```{r save 6}
ggsave(filename = "fig6a_final.png", 
       plot = fig6a,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig6b_final.png", 
       plot = fig6b,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig6c_final.png", 
       plot = fig6c,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig6d_final.png", 
       plot = fig6d,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

```{r save 6b}
ggsave(filename = "fig6_a_final.png", 
       plot = fig6_a,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig6_b_final.png", 
       plot = fig6_b,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig6_c_final.png", 
       plot = fig6_c,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig6_d_final.png", 
       plot = fig6_d,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

Figure of As/Al and Height over time
```{r figure 7}
z1 <- (dt_virg_sum$h[dt_virg_sum$y == 2022]/dt_virg_sum$h[dt_virg_sum$y == 2018])-1
z2 <- (dt_short_sum$h[dt_short_sum$y == 2022]/dt_short_sum$h[dt_short_sum$y == 2018])-1
z3 <- (dt_lob2_sum$h[dt_lob2_sum$y == 2022]/dt_lob2_sum$h[dt_lob2_sum$y == 2018])-1
z4 <- (dt_lob1_sum$h[dt_lob1_sum$y == 2022]/dt_lob1_sum$h[dt_lob1_sum$y == 2018])-1
z5 <- (dt_slash_sum$h[dt_slash_sum$y == 2022]/dt_slash_sum$h[dt_slash_sum$y == 2018])-1
z6 <- (dt_long_sum$h[dt_long_sum$y == 2021]/dt_long_sum$h[dt_long_sum$y == 2018])-1

mean(abs(c(z1, z2, z3, z4, z5, z6)))
sd(abs(c(z1, z2, z3, z4, z5, z6)))

dt_virg_sum$h[dt_virg_sum$y == 2018]

virg_y <- (dt_virg_sum$as[dt_virg_sum$y == 2022]-dt_virg_sum$as[dt_virg_sum$y == 2018])/
  (dt_virg_sum$h[dt_virg_sum$y == 2022]-dt_virg_sum$h[dt_virg_sum$y == 2018])
virg_x <- 7.51

short_y <- (dt_short_sum$as[dt_short_sum$y == 2022]-dt_short_sum$as[dt_short_sum$y == 2018])/
  (dt_short_sum$h[dt_short_sum$y == 2022]-dt_short_sum$h[dt_short_sum$y == 2018])
short_x <- 9.28

lob2_y <- (dt_lob2_sum$as[dt_lob2_sum$y == 2022]-dt_lob2_sum$as[dt_lob2_sum$y == 2018])/
  (dt_lob2_sum$h[dt_lob2_sum$y == 2022]-dt_lob2_sum$h[dt_lob2_sum$y == 2018])
lob2_x <- 17.32

lob1_y <- (dt_lob1_sum$as[dt_lob1_sum$y == 2022]-dt_lob1_sum$as[dt_lob1_sum$y == 2018])/
  (dt_lob1_sum$h[dt_lob1_sum$y == 2022]-dt_lob1_sum$h[dt_lob1_sum$y == 2018])
lob1_x <- 19.69

slash_y <- (dt_slash_sum$as[dt_slash_sum$y == 2022]-dt_slash_sum$as[dt_slash_sum$y == 2018])/
  (dt_slash_sum$h[dt_slash_sum$y == 2022]-dt_slash_sum$h[dt_slash_sum$y == 2018])
slash_x <- 23.23

long_y <- (dt_long_sum$as[dt_long_sum$y == 2021]-dt_long_sum$as[dt_long_sum$y == 2018])/
  (dt_long_sum$h[dt_long_sum$y == 2021]-dt_long_sum$h[dt_long_sum$y == 2018])
long_x <- 34.59

comp_y <- c(virg_y, short_y, lob2_y, lob1_y, slash_y, long_y)
needle_x <- c(virg_x, short_x, lob2_x, lob1_x, slash_x, long_x)


#Figure 7: AsAl compensation and needle length
plot(needle_x, comp_y, xlab = "Needle Length (cm)", ylab = "As/Al/h", pch = 19)
abline(lm(comp_y~needle_x), col = 'red')
summary(lm(comp_y~needle_x))

fig7_df <- data.frame(Needle = needle_x, Compensation = comp_y, Species = c("Virginia", "Shortleaf", "Loblolly2", "Loblolly1", "Slash", "Longleaf"))

x <- seq(7, 35, 0.001)
fig7_line <- data.frame(X = x, Line = (0.0580633-0.0029300*x), Species = NA)

fig7 <- ggplot(fig7_df, aes(x = Needle, y = Compensation, col = Species)) + geom_point(size = 5) + geom_smooth(method = 'lm', se = F) + scale_color_discrete(type = c(lob2fill, lob1fill, longfill, shortleaffill, slashfill, virginiafill)) + theme_few() + theme(legend.position = 'none', plot.title=element_text( hjust=1, vjust=1, face='italic', size = 26)) + ggtitle("Duke Forest, 2018-2022")  + annotate('text', x = 30, y = 0.05, label = bquote(R^{2} ~ "= 0.65"), cex = 8) + geom_line(data = fig7_line, aes(x = X, y = Line), lwd = 1.5)  + annotate('text', x = 30, y = 0.04, label = "p = 0.03", cex = 8) + labs(x = "Needle Length (cm)", y = bquote("Δ Mean" ~ A[S] ~ "/" ~ A[L] ~ ": Δ Height"~ "(" ~ cm^{2} ~ m^{-3} ~ ")")) + ggtitle("Duke Forest, 2018-2022") +
  theme(axis.text.x = element_text(size = 22), axis.text.y = element_text(size = 22), axis.title.x = element_text(size = 24), axis.title.y = element_text(size = 24))
```

```{r save 7}
ggsave(filename = "figure_7.png", 
       plot = fig7,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

The relative contributions of each of the hydraulic variables to the lumped parameter over time.
```{r figure S3 - previously 8s}
stack <- read.csv("stackbar.csv")

fig8s_a <- ggplot(stack, aes(x = Year, y = Virginia, fill = Type)) +
  geom_col() + labs(x = NULL, y = "Rel. Contribution to KL'") + ggtitle("P. virginiana") +
  scale_fill_discrete(type = c(lob2_purple, short_orange, virg_teal)) + theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26),  axis.title.x =  element_text(size = 18, colour = 'black'), axis.text.x = element_text(size = 24, colour = 'black'),  axis.text.y = element_text(size = 24, colour = 'black'), legend.position = 'none') + 
  annotate('text', x = 2018, y = .72, label = bquote(A[S] ~ "/" ~ A[L]), cex = 6, col = 'white') + 
  annotate('text', x = 2018, y = .375, label = bquote(ΔΨ), cex = 8, col = 'white') + 
annotate('text', x = 2018, y = .05, label = bquote("1/" ~ h), cex = 8, col = 'white') + annotate('text', x = 2017.65, y = 1.05, label = "A", cex = 8, fontface = 'bold')

fig8s_b <- ggplot(stack, aes(x = Year, y = Shortleaf, fill = Type)) +
  geom_col() + labs(x = NULL, y = "Rel. Contribution to KL'") + ggtitle("P. echinata") +
  scale_fill_discrete(type = c(lob2_purple, short_orange, virg_teal)) + theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26),  axis.title.x =  element_text(size = 18, colour = 'black'), axis.text.x = element_text(size = 24, colour = 'black'),  axis.text.y = element_text(size = 24, colour = 'black'), legend.position = 'none') + 
  annotate('text', x = 2018, y = .72, label = bquote(A[S] ~ "/" ~ A[L]), cex = 6, col = 'white') + 
  annotate('text', x = 2018, y = .375, label = bquote(ΔΨ), cex = 8, col = 'white') + 
annotate('text', x = 2018, y = .05, label = bquote("1/" ~ h), cex = 8, col = 'white') + annotate('text', x = 2017.65, y = 1.05, label = "B", cex = 8, fontface = 'bold')

fig8s_c <- ggplot(stack, aes(x = Year, y = Loblolly2, fill = Type)) +
  geom_col() + labs(x = NULL, y = "Rel. Contribution to KL'") + ggtitle("P. taeda (2)") +
  scale_fill_discrete(type = c(lob2_purple, short_orange, virg_teal)) + theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26),  axis.title.x =  element_text(size = 18, colour = 'black'), axis.text.x = element_text(size = 24, colour = 'black'),  axis.text.y = element_text(size = 24, colour = 'black'), legend.position = 'none') + 
  annotate('text', x = 2018, y = .72, label = bquote(A[S] ~ "/" ~ A[L]), cex = 6, col = 'white') + 
  annotate('text', x = 2018, y = .375, label = bquote(ΔΨ), cex = 8, col = 'white') + 
annotate('text', x = 2018, y = .05, label = bquote("1/" ~ h), cex = 8, col = 'white') + annotate('text', x = 2017.65, y = 1.05, label = "C", cex = 8, fontface = 'bold')

fig8s_d <- ggplot(stack, aes(x = Year, y = Loblolly1, fill = Type)) +
  geom_col() + labs(x = NULL, y = "Rel. Contribution to KL'") + ggtitle("P. taeda (1)") +
  scale_fill_discrete(type = c(lob2_purple, short_orange, virg_teal)) + theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26),  axis.title.x =  element_text(size = 18, colour = 'black'), axis.text.x = element_text(size = 24, colour = 'black'),  axis.text.y = element_text(size = 24, colour = 'black'), legend.position = 'none') + 
  annotate('text', x = 2018, y = .72, label = bquote(A[S] ~ "/" ~ A[L]), cex = 6, col = 'white') + 
  annotate('text', x = 2018, y = .375, label = bquote(ΔΨ), cex = 8, col = 'white') + 
annotate('text', x = 2018, y = .05, label = bquote("1/" ~ h), cex = 8, col = 'white') + annotate('text', x = 2017.65, y = 1.05, label = "D", cex = 8, fontface = 'bold')

fig8s_e <- ggplot(stack, aes(x = Year, y = Slash, fill = Type)) +
  geom_col() + labs(x = NULL, y = "Rel. Contribution to KL'") + ggtitle("P. elliottii") +
  scale_fill_discrete(type = c(lob2_purple, short_orange, virg_teal)) + theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26),  axis.title.x =  element_text(size = 18, colour = 'black'), axis.text.x = element_text(size = 24, colour = 'black'),  axis.text.y = element_text(size = 24, colour = 'black'), legend.position = 'none') + 
  annotate('text', x = 2018, y = .72, label = bquote(A[S] ~ "/" ~ A[L]), cex = 6, col = 'white') + 
  annotate('text', x = 2018, y = .375, label = bquote(ΔΨ), cex = 8, col = 'white') + 
annotate('text', x = 2018, y = .05, label = bquote("1/" ~ h), cex = 8, col = 'white') + annotate('text', x = 2017.65, y = 1.05, label = "E", cex = 8, fontface = 'bold')

fig8s_f <- ggplot(stack, aes(x = Year, y = Longleaf, fill = Type)) +
  geom_col() + labs(x = NULL, y = "Rel. Contribution to KL'") + ggtitle("P. palustris") +
  scale_fill_discrete(type = c(lob2_purple, short_orange, virg_teal)) + theme_few() + theme(plot.title=element_text( hjust=1, vjust=1, face='italic', margin=margin(t=20,b=0)), title = element_text(size = 26),  axis.title.x =  element_text(size = 18, colour = 'black'), axis.text.x = element_text(size = 24, colour = 'black'),  axis.text.y = element_text(size = 24, colour = 'black'), legend.position = 'none') + lims(x = c(2017.55, 2022.25)) +
  annotate('text', x = 2018, y = .72, label = bquote(A[S] ~ "/" ~ A[L]), cex = 6, col = 'white') + 
  annotate('text', x = 2018, y = .375, label = bquote(ΔΨ), cex = 8, col = 'white') + 
annotate('text', x = 2018, y = .05, label = bquote("1/" ~ h), cex = 8, col = 'white') + annotate('text', x = 2017.65, y = 1.05, label = "F", cex = 8, fontface = 'bold')
```

```{r save S3}
ggsave(filename = "fig8_a_final.png", 
       plot = fig8s_a,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig8_b_final.png", 
       plot = fig8s_b,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig8_c_final.png", 
       plot = fig8s_c,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig8_d_final.png", 
       plot = fig8s_d,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig8_e_final.png", 
       plot = fig8s_e,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)

ggsave(filename = "fig8_f_final.png", 
       plot = fig8s_f,
       width = 15, 
       height = 15,
       units = "cm",
       dpi = 600)
```

